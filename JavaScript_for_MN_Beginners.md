# ğŸ“š é€šè¿‡ MarginNote ä»£ç å­¦ä¹  JavaScriptï¼šä»é›¶åŸºç¡€åˆ°å…¥é—¨

> ğŸ¯ **æœ¬æ–‡ç›®æ ‡**ï¼šè®©å®Œå…¨æ²¡æœ‰ç¼–ç¨‹ç»éªŒçš„å°ç™½ï¼Œé€šè¿‡ MarginNote æ’ä»¶çš„çœŸå®ä»£ç ï¼Œç³»ç»Ÿå­¦ä¹  JavaScript çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒæŒæ¡ç°ä»£ç¼–ç¨‹æ€ç»´ã€‚

## ğŸ“– å‰è¨€ï¼šä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§å­¦ä¹ æ–¹å¼ï¼Ÿ

### ğŸ¤” ä¼ ç»Ÿ JavaScript æ•™ç¨‹çš„é—®é¢˜

ä¼ ç»Ÿçš„ JavaScript æ•™ç¨‹å¾€å¾€ï¼š
- **è„±ç¦»å®é™…**ï¼šç”¨çš„éƒ½æ˜¯ `hello world`ã€è®¡ç®—å™¨è¿™æ ·çš„ç©å…·ä¾‹å­
- **ç¯å¢ƒå¤æ‚**ï¼šéœ€è¦é…ç½® Node.jsã€æµè§ˆå™¨å¼€å‘å·¥å…·ç­‰
- **å­¦å®Œæ²¡ç”¨**ï¼šå­¦äº†è¯­æ³•å´ä¸çŸ¥é“èƒ½åšä»€ä¹ˆ

### ğŸŒŸ é€šè¿‡ MarginNote ä»£ç å­¦ä¹ çš„ä¼˜åŠ¿

å¦‚æœä½ æ˜¯ MarginNote çš„ç”¨æˆ·ï¼Œä½ å·²ç»è§è¿‡å„ç§å¼ºå¤§çš„æ’ä»¶ï¼šMNUtilsã€MNToolbarã€MNChatGLM ç­‰ã€‚è¿™äº›æ’ä»¶ä»£ç æ˜¯**æ´»çš„æ•™æ**ï¼š

1. **çœŸå®ä»£ç ï¼Œç«‹å³èƒ½æ‡‚**ï¼šæ¯è¡Œä»£ç éƒ½æœ‰æ˜ç¡®çš„ä½œç”¨
2. **æ— éœ€é…ç½®ç¯å¢ƒ**ï¼šMarginNote å°±æ˜¯è¿è¡Œç¯å¢ƒ
3. **å­¦ä»¥è‡´ç”¨**ï¼šç†è§£äº†è¯­æ³•å°±èƒ½ç†è§£æ’ä»¶å¦‚ä½•å·¥ä½œ
4. **å¾ªåºæ¸è¿›**ï¼šä»ç®€å•çš„å˜é‡åˆ°å¤æ‚çš„ç±»ï¼Œåº”æœ‰å°½æœ‰

### ğŸ¯ ä½ å°†å­¦åˆ°ä»€ä¹ˆ

**è¿™ä¸æ˜¯æ’ä»¶å¼€å‘æ•™ç¨‹**ï¼Œè€Œæ˜¯ **JavaScript è¯­è¨€å­¦ä¹ æ•™ç¨‹**ã€‚å­¦å®Œåä½ å°†æŒæ¡ï¼š

#### æ ¸å¿ƒè¯­è¨€ç‰¹æ€§
- å˜é‡ã€å‡½æ•°ã€å¯¹è±¡çš„æœ¬è´¨
- é¢å‘å¯¹è±¡ç¼–ç¨‹æ€ç»´
- å¼‚æ­¥ç¼–ç¨‹æ¦‚å¿µ
- ç°ä»£ JavaScript è¯­æ³•

#### ç¼–ç¨‹æ€ç»´
- å¦‚ä½•åˆ†è§£å¤æ‚é—®é¢˜
- å¦‚ä½•ç»„ç»‡ä»£ç ç»“æ„
- å¦‚ä½•å¤„ç†é”™è¯¯å’Œå¼‚å¸¸
- å¦‚ä½•é˜…è¯»ä»–äººçš„ä»£ç 

#### é¢å¤–æ”¶è·
- èƒ½çœ‹æ‡‚ä»»ä½• MarginNote æ’ä»¶çš„ä»£ç 
- ä¸ºè¿›ä¸€æ­¥å­¦ä¹ å‰ç«¯å¼€å‘æ‰“ä¸‹åŸºç¡€
- å…·å¤‡é˜…è¯»å…¶ä»– JavaScript é¡¹ç›®çš„èƒ½åŠ›

### ğŸ—ºï¸ å­¦ä¹ è·¯çº¿å›¾

```
ç¬¬ä¸€éƒ¨åˆ†ï¼šJavaScript åŸºç¡€ (ç¬¬1-4ç« )
â”œâ”€â”€ æ•°æ®ä¸å˜é‡ï¼šç¨‹åºå¦‚ä½•è®°ä½ä¿¡æ¯
â”œâ”€â”€ å‡½æ•°ï¼šä»£ç å¦‚ä½•å¤ç”¨å’Œç»„ç»‡
â”œâ”€â”€ æ§åˆ¶æµç¨‹ï¼šç¨‹åºå¦‚ä½•åšå†³å®š
â””â”€â”€ å¤åˆæ•°æ®ï¼šå¦‚ä½•å¤„ç†å¤æ‚ä¿¡æ¯

ç¬¬äºŒéƒ¨åˆ†ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ (ç¬¬5-7ç« )  
â”œâ”€â”€ å¯¹è±¡å’Œç±»ï¼šå¦‚ä½•æè¿°ç°å®ä¸–ç•Œ
â”œâ”€â”€ å‡½æ•°è¿›é˜¶ï¼šthisã€é—­åŒ…ç­‰é«˜çº§æ¦‚å¿µ
â””â”€â”€ ç»§æ‰¿ä¸å¤šæ€ï¼šä»£ç å¦‚ä½•å¤ç”¨å’Œæ‰©å±•

ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¼‚æ­¥ç¼–ç¨‹ (ç¬¬8ç« )
â””â”€â”€ Promise ä¸ async/awaitï¼šå¦‚ä½•å¤„ç†å»¶æ—¶æ“ä½œ

é™„å½•ï¼šå‚è€ƒèµ„æ–™
â”œâ”€â”€ JavaScript è¯­æ³•é€ŸæŸ¥è¡¨
â”œâ”€â”€ å¸¸è§é”™è¯¯å’Œè°ƒè¯•æŠ€å·§
â””â”€â”€ è¿›é˜¶å­¦ä¹ èµ„æºæ¨è
```

### ğŸ’¡ å¦‚ä½•ä½¿ç”¨è¿™ä»½æ•™ç¨‹

1. **æŒ‰é¡ºåºé˜…è¯»**ï¼šæ¯ç« éƒ½å»ºç«‹åœ¨å‰ç« çš„åŸºç¡€ä¸Š
2. **åŠ¨æ‰‹å®è·µ**ï¼šçœ‹åˆ°ä»£ç å°±åœ¨ MarginNote ä¸­è¿è¡Œè¯•è¯•
3. **ç†è§£æœ¬è´¨**ï¼šé‡ç‚¹ç†è§£æ¦‚å¿µï¼Œè€Œä¸æ˜¯èƒŒè¯µè¯­æ³•
4. **è”ç³»å®é™…**ï¼šæ€è€ƒå­¦åˆ°çš„æ¦‚å¿µå¦‚ä½•åº”ç”¨åˆ°å…¶ä»–åœºæ™¯

> ğŸ’¡ **å­¦ä¹ åŸåˆ™**ï¼š"ç†è§£æ¯”è®°å¿†é‡è¦ï¼Œåº”ç”¨æ¯”è¯­æ³•é‡è¦ï¼Œæ€ç»´æ¯”æŠ€å·§é‡è¦"

è®©æˆ‘ä»¬å¼€å§‹è¿™åœºæœ‰è¶£çš„ JavaScript å­¦ä¹ ä¹‹æ—…ï¼

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šJavaScript åŸºç¡€æ¦‚å¿µ

### ç¬¬1ç« ï¼šæ•°æ®ä¸å˜é‡ - ç¨‹åºçš„åŸºç¡€

#### 1.1 ç¬¬ä¸€ä¸ªå˜é‡

> ğŸ¤” **é—®é¢˜**ï¼šç¨‹åºå¦‚ä½•è®°ä½ä¿¡æ¯ï¼Ÿæ¯”å¦‚ï¼Œæˆ‘æƒ³è®© MarginNote è®°ä½æˆ‘çš„åå­—ï¼Œä¸‹æ¬¡æ‰“å¼€æ—¶æ˜¾ç¤º"æ¬¢è¿å›æ¥ï¼Œå°æ˜"ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ

è¿™å°±éœ€è¦ç”¨åˆ°**å˜é‡**äº†ï¼

**å˜é‡å°±åƒä¸€ä¸ªè´´ç€æ ‡ç­¾çš„ç›’å­**ï¼šä½ å¯ä»¥å¾€é‡Œé¢æ”¾ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥ä»é‡Œé¢å–ä¸œè¥¿ã€‚æ ‡ç­¾å°±æ˜¯å˜é‡åï¼Œé‡Œé¢çš„ä¸œè¥¿å°±æ˜¯å˜é‡çš„å€¼ã€‚

**ç«‹å³å®è·µ**ï¼š

```javascript
// æœ€ç®€å•çš„ä¾‹å­ï¼šåˆ›å»ºä¸€ä¸ªå˜é‡
let userName = "å°æ˜";

// ä½¿ç”¨å˜é‡ï¼šè®© MarginNote æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
MNUtil.showHUD("æ¬¢è¿å›æ¥ï¼Œ" + userName);
```

**è¿è¡Œç»“æœ**ï¼šMarginNote ä¼šæ˜¾ç¤º"æ¬¢è¿å›æ¥ï¼Œå°æ˜"

**ä»£ç è§£é‡Š**ï¼š
- `let userName` â†’ åˆ›å»ºä¸€ä¸ªåä¸º `userName` çš„å˜é‡
- `= "å°æ˜"` â†’ å‘å˜é‡é‡Œæ”¾å…¥æ–‡å­—"å°æ˜" 
- `userName` â†’ å–å‡ºå˜é‡çš„å€¼
- `+` â†’ è¿æ¥ä¸¤æ®µæ–‡å­—

**ğŸ¯ è¯•è¯•çœ‹**ï¼šä¿®æ”¹ä»£ç ï¼ŒæŠŠ"å°æ˜"æ”¹æˆä½ çš„åå­—ï¼Œç„¶åè¿è¡Œçœ‹ç»“æœã€‚

#### 1.2 åŸºç¡€æ•°æ®ç±»å‹

> ğŸ¤” **é—®é¢˜**ï¼šJavaScript èƒ½å¤„ç†å“ªäº›ç±»å‹çš„æ•°æ®ï¼Ÿ

å°±åƒç›’å­å¯ä»¥è£…ä¸åŒçš„ä¸œè¥¿ï¼ˆä¹¦æœ¬ã€ç©å…·ã€é£Ÿç‰©ï¼‰ï¼Œå˜é‡ä¹Ÿå¯ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼š

##### æ–‡å­—ï¼ˆå­—ç¬¦ä¸²ï¼‰
```javascript
let message = "Hello MarginNote";
let noteName = "æˆ‘çš„ç¬”è®°";
let emoji = "ğŸ˜€";

MNUtil.showHUD(message);  // æ˜¾ç¤ºæ–‡å­—
```

##### æ•°å­—
```javascript
let age = 25;
let price = 99.9;
let count = 0;

MNUtil.showHUD("age = " + age);  // æ˜¾ç¤ºï¼šage = 25
```

##### çœŸå‡åˆ¤æ–­ï¼ˆå¸ƒå°”å€¼ï¼‰
```javascript
let isReady = true;   // çœŸ
let isEmpty = false;  // å‡

if (isReady) {
  MNUtil.showHUD("å‡†å¤‡å®Œæˆï¼");
}
```

**ğŸ“ å…³äºå¼•å·**ï¼š
- æ–‡å­—éœ€è¦ç”¨å¼•å·åŒ…å›´ï¼š`"Hello"`
- æ•°å­—ä¸éœ€è¦å¼•å·ï¼š`123`
- `true`/`false` ä¹Ÿä¸éœ€è¦å¼•å·

**âœ¨ å®æˆ˜ä¾‹å­**ï¼šä» MarginNote ä»£ç ä¸­çœ‹å®é™…åº”ç”¨

```javascript
// æ¥è‡ª mntoolbar/xdyy_button_registry.js çš„çœŸå®ä»£ç 
global.registerButton("custom15", {
  name: "æ—¶é—´æˆ³",        // å­—ç¬¦ä¸²ï¼šæŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—
  image: "custom15",     // å­—ç¬¦ä¸²ï¼šå›¾æ ‡æ–‡ä»¶å
  templateName: "menu_timestamp"  // å­—ç¬¦ä¸²ï¼šèœå•æ¨¡æ¿å
});

// æ¥è‡ª mnutils.js çš„çœŸå®ä»£ç 
note.colorIndex = 3;     // æ•°å­—ï¼šé¢œè‰²ç´¢å¼•ï¼ˆ0-15ï¼‰
note.fillIndex = 0;      // æ•°å­—ï¼šå¡«å……æ ·å¼ç´¢å¼•
menu.rowHeight = 35;     // æ•°å­—ï¼šèœå•è¡Œé«˜ï¼ˆåƒç´ ï¼‰
```

**ğŸ” è§‚å¯Ÿä¸€ä¸‹**ï¼š
- å“ªäº›ç”¨äº†å¼•å·ï¼Ÿï¼ˆé‚£äº›æ˜¯å­—ç¬¦ä¸²ï¼‰
- å“ªäº›æ²¡ç”¨å¼•å·ï¼Ÿï¼ˆé‚£äº›æ˜¯æ•°å­—ï¼‰

#### 1.3 å˜é‡çš„ä½œç”¨åŸŸåˆæ­¥

> ğŸ¤” **é—®é¢˜**ï¼šå˜é‡ä»€ä¹ˆæ—¶å€™å­˜åœ¨ï¼Œä»€ä¹ˆæ—¶å€™æ¶ˆå¤±ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹ä½ åœ¨å®¶é‡Œå’Œåœ¨å­¦æ ¡ï¼š
- **åœ¨å®¶é‡Œ**ï¼šä½ å¯ä»¥ä½¿ç”¨å®¶é‡Œæ‰€æœ‰çš„ä¸œè¥¿
- **åœ¨å­¦æ ¡**ï¼šä½ åªèƒ½ä½¿ç”¨å­¦æ ¡çš„ä¸œè¥¿ï¼Œä¸èƒ½ç”¨å®¶é‡Œçš„

å˜é‡ä¹Ÿæ˜¯è¿™æ ·çš„é“ç†ï¼š

```javascript
let globalMessage = "æˆ‘åœ¨å…¨å±€åŒºåŸŸ";  // å…¨å±€å˜é‡ï¼šåœ¨å“ªé‡Œéƒ½èƒ½ç”¨

function showWelcome() {
  let localMessage = "æˆ‘åœ¨å‡½æ•°å†…éƒ¨";  // å±€éƒ¨å˜é‡ï¼šåªåœ¨è¿™ä¸ªå‡½æ•°é‡Œèƒ½ç”¨
  
  MNUtil.showHUD(globalMessage);  // âœ… å¯ä»¥ç”¨å…¨å±€å˜é‡
  MNUtil.showHUD(localMessage);   // âœ… å¯ä»¥ç”¨å±€éƒ¨å˜é‡
}

showWelcome();
MNUtil.showHUD(globalMessage);  // âœ… è¿˜æ˜¯å¯ä»¥ç”¨å…¨å±€å˜é‡
// MNUtil.showHUD(localMessage);   // âŒ é”™è¯¯ï¼å‡½æ•°å¤–é¢ç”¨ä¸äº†å±€éƒ¨å˜é‡
```

**è®°ä½**ï¼š
- å…¨å±€å˜é‡ = å®¶é‡Œçš„ä¸œè¥¿ï¼Œåœ¨å“ªé‡Œéƒ½èƒ½ç”¨
- å±€éƒ¨å˜é‡ = æ•™å®¤é‡Œçš„ä¸œè¥¿ï¼Œåªèƒ½åœ¨è¿™ä¸ªæ•™å®¤é‡Œç”¨

**ğŸ¯ å°ç»ƒä¹ **ï¼š
è¯•è¯•åˆ›å»ºä¸€ä¸ªå˜é‡å­˜å‚¨ä½ çš„åå­—ï¼Œç„¶åè®© MarginNote æ˜¾ç¤ºé—®å€™ä¿¡æ¯ã€‚

---

### ç¬¬1ç« å°ç»“

æ­å–œï¼ä½ å·²ç»å­¦ä¼šäº†ï¼š
âœ… ç”¨å˜é‡å­˜å‚¨ä¿¡æ¯  
âœ… åŒºåˆ†æ–‡å­—ã€æ•°å­—å’ŒçœŸå‡å€¼
âœ… ç†è§£å…¨å±€å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æƒ³è®©åŒæ ·çš„ä»£ç æ‰§è¡Œå¤šæ¬¡æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚ï¼Œç»™ä¸åŒçš„äººæ˜¾ç¤ºä¸åŒçš„æ¬¢è¿ä¿¡æ¯ï¼Ÿ

è¿™å°±éœ€è¦ç”¨åˆ°**å‡½æ•°**äº†â€”â€”è®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ç« çš„å­¦ä¹ å§ï¼

---

### ç¬¬2ç« ï¼šå‡½æ•° - è®©ä»£ç å¯ä»¥é‡å¤ä½¿ç”¨

> ğŸ¤” **é—®é¢˜**ï¼šæ¯æ¬¡éƒ½å†™ `MNUtil.showHUD()` å¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”å¦‚æœæˆ‘æƒ³ç»™100ä¸ªä¸åŒçš„ç”¨æˆ·æ˜¾ç¤ºé—®å€™ï¼Œéš¾é“è¦å†™100è¡Œä»£ç å—ï¼Ÿ

**å‡½æ•°å°±åƒä¸€å°æœºå™¨**ï¼šä½ æŠŠåŸæ–™ï¼ˆè¾“å…¥ï¼‰æ”¾è¿›å»ï¼Œæœºå™¨åŠ å·¥åç»™ä½ äº§å“ï¼ˆè¾“å‡ºï¼‰ã€‚

#### 2.1 ç¬¬ä¸€ä¸ªå‡½æ•°

```javascript
// ä¸ç”¨å‡½æ•°çš„å†™æ³•ï¼šé‡å¤ä»£ç å¾ˆå¤š
MNUtil.showHUD("æ¬¢è¿å›æ¥ï¼Œå°æ˜");
MNUtil.showHUD("æ¬¢è¿å›æ¥ï¼Œå°çº¢");  
MNUtil.showHUD("æ¬¢è¿å›æ¥ï¼Œå°åˆš");
// ...å¦‚æœæœ‰100ä¸ªç”¨æˆ·ï¼Œè¦å†™100è¡Œï¼

// ç”¨å‡½æ•°çš„å†™æ³•ï¼šä»£ç å¯ä»¥å¤ç”¨
function sayWelcome(name) {  // nameæ˜¯å‚æ•°ï¼šæ¥æ”¶å¤–éƒ¨è¾“å…¥
  MNUtil.showHUD("æ¬¢è¿å›æ¥ï¼Œ" + name);
}

// è°ƒç”¨å‡½æ•°ï¼šä¸€è¡Œä»£ç æå®š
sayWelcome("å°æ˜");  // ä¼ å…¥å‚æ•°"å°æ˜"
sayWelcome("å°çº¢");  // ä¼ å…¥å‚æ•°"å°çº¢"  
sayWelcome("å°åˆš");  // ä¼ å…¥å‚æ•°"å°åˆš"
```

**ä»£ç è§£é‡Š**ï¼š
- `function sayWelcome(name)` â†’ åˆ›å»ºä¸€ä¸ªåä¸º `sayWelcome` çš„å‡½æ•°
- `name` â†’ å‚æ•°ï¼Œå°±åƒå‡½æ•°çš„"è¾“å…¥å£"
- `sayWelcome("å°æ˜")` â†’ è°ƒç”¨å‡½æ•°ï¼ŒæŠŠ"å°æ˜"ä¼ ç»™å‚æ•° `name`

**ğŸ¯ è¯•è¯•çœ‹**ï¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œèƒ½æ˜¾ç¤ºä»»æ„æ•°å­—çš„å¹³æ–¹ï¼ˆæ¯”å¦‚è¾“å…¥3ï¼Œæ˜¾ç¤º9ï¼‰

#### 2.2 å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼

> ğŸ¤” **é—®é¢˜**ï¼šå‡½æ•°å¦‚ä½•æ¥æ”¶è¾“å…¥å’Œäº§ç”Ÿè¾“å‡ºï¼Ÿ

**å‚æ•° = å‡½æ•°çš„è¾“å…¥**
```javascript
function greetUser(name, age) {  // ä¸¤ä¸ªå‚æ•°ï¼šname å’Œ age
  MNUtil.showHUD(name + " ä»Šå¹´ " + age + " å²");
}

greetUser("å°æ˜", 25);  // ä¼ å…¥ä¸¤ä¸ªå‚æ•°
```

**è¿”å›å€¼ = å‡½æ•°çš„è¾“å‡º**
```javascript
function calculateAge(birthYear) {
  let currentYear = 2024;
  let age = currentYear - birthYear;
  return age;  // è¿”å›è®¡ç®—ç»“æœ
}

let myAge = calculateAge(1990);  // æ¥æ”¶è¿”å›å€¼
MNUtil.showHUD("æˆ‘ä»Šå¹´ " + myAge + " å²");  // æ˜¾ç¤ºï¼šæˆ‘ä»Šå¹´ 34 å²
```

**âœ¨ MarginNote ä¸­çš„å®é™…ä¾‹å­**
```javascript
// æ¥è‡ª mnutils.js çš„çœŸå®å‡½æ•°
function strCode(str) {
  let width = 0;
  for (let i = 0; i < str.length; i++) {
    if (str.charCodeAt(i) > 127) {
      width += 2;  // ä¸­æ–‡å­—ç¬¦ç®—2ä¸ªå®½åº¦
    } else {
      width += 1;  // è‹±æ–‡å­—ç¬¦ç®—1ä¸ªå®½åº¦
    }
  }
  return width;  // è¿”å›å­—ç¬¦ä¸²æ˜¾ç¤ºå®½åº¦
}

// ä½¿ç”¨è¿™ä¸ªå‡½æ•°
let titleWidth = strCode("æˆ‘çš„ç¬”è®°");
MNUtil.showHUD("æ ‡é¢˜å®½åº¦ï¼š" + titleWidth);
```

#### 2.3 å‡½æ•°çš„ä½œç”¨åŸŸ

> ğŸ¤” **é—®é¢˜**ï¼šå‡½æ•°é‡Œçš„å˜é‡å’Œå¤–é¢çš„å˜é‡æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ

å‡½æ•°å°±åƒæˆ¿é—´ï¼Œæœ‰è‡ªå·±çš„"ç§äººç©ºé—´"ï¼š

```javascript
let globalName = "å…¨å±€å°æ˜";  // å®¢å…çš„ä¸œè¥¿ï¼Œå¤§å®¶éƒ½èƒ½ç”¨

function showUserInfo() {
  let localName = "å‡½æ•°å°çº¢";  // æˆ¿é—´é‡Œçš„ä¸œè¥¿ï¼Œåªæœ‰æˆ¿é—´é‡Œèƒ½ç”¨
  
  MNUtil.showHUD("å…¨å±€ï¼š" + globalName);  // âœ… èƒ½è®¿é—®å¤–é¢çš„
  MNUtil.showHUD("å±€éƒ¨ï¼š" + localName);   // âœ… èƒ½è®¿é—®è‡ªå·±çš„
}

showUserInfo();
MNUtil.showHUD("å¤–éƒ¨ï¼š" + globalName);  // âœ… å¤–é¢ä¹Ÿèƒ½ç”¨å…¨å±€çš„
// MNUtil.showHUD("å¤–éƒ¨ï¼š" + localName);   // âŒ å¤–é¢ç”¨ä¸äº†æˆ¿é—´é‡Œçš„
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```javascript
// MarginNote ä¸­çš„å®é™…ä¾‹å­
function processNote() {
  let note = MNNote.getFocusNote();  // å‡½æ•°å†…éƒ¨å˜é‡
  
  if (note) {
    let noteTitle = note.noteTitle;   // åªåœ¨è¿™ä¸ªå‡½æ•°é‡Œç”¨
    MNUtil.showHUD("å¤„ç†ç¬”è®°ï¼š" + noteTitle);
  }
}
// å¤–é¢è®¿é—®ä¸åˆ° note å’Œ noteTitleï¼Œå¾ˆå®‰å…¨ï¼
```

#### 2.4 ç®­å¤´å‡½æ•°åˆæ­¥è®¤è¯†

> ğŸ¤” **é—®é¢˜**ï¼šæœ‰æ²¡æœ‰æ›´ç®€æ´çš„å‡½æ•°å†™æ³•ï¼Ÿ

æœ‰ï¼ç®­å¤´å‡½æ•°å°±åƒå‡½æ•°çš„"ç®€åŒ–ç‰ˆ"ï¼š

```javascript
// æ™®é€šå‡½æ•°å†™æ³•
function sayHello(name) {
  return "Hello " + name;
}

// ç®­å¤´å‡½æ•°å†™æ³•
const sayHello2 = (name) => {
  return "Hello " + name;
}

// æ›´ç®€æ´çš„ç®­å¤´å‡½æ•°ï¼ˆå•è¡Œæ—¶å¯çœç•¥å¤§æ‹¬å·å’Œreturnï¼‰
const sayHello3 = (name) => "Hello " + name;

// ä½¿ç”¨æ•ˆæœå®Œå…¨ä¸€æ ·
MNUtil.showHUD(sayHello("å°æ˜"));   // Hello å°æ˜
MNUtil.showHUD(sayHello2("å°çº¢"));  // Hello å°çº¢
MNUtil.showHUD(sayHello3("å°åˆš"));  // Hello å°åˆš
```

**ä½•æ—¶ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ**
- ç®€å•çš„è®¡ç®—ï¼š`const double = (x) => x * 2`
- æ•°ç»„å¤„ç†ï¼š`numbers.map(x => x * 2)`
- çŸ­å°çš„å·¥å…·å‡½æ•°

**ç®­å¤´å‡½æ•°çš„ç‰¹ç‚¹**ï¼š
- å†™æ³•æ›´ç®€æ´
- é€‚åˆç®€å•é€»è¾‘
- ï¼ˆé«˜çº§ç‰¹æ€§ï¼šthisæŒ‡å‘ä¸åŒï¼Œæˆ‘ä»¬ç¬¬6ç« è¯¦ç»†è®²ï¼‰

---

### ç¬¬2ç« å°ç»“

æ­å–œï¼ä½ å·²ç»å­¦ä¼šäº†ï¼š
âœ… ç”¨å‡½æ•°é¿å…é‡å¤ä»£ç 
âœ… ä¼ é€’å‚æ•°å’Œæ¥æ”¶è¿”å›å€¼
âœ… ç†è§£å‡½æ•°çš„ä½œç”¨åŸŸ
âœ… è®¤è¯†ç®­å¤´å‡½æ•°çš„åŸºæœ¬ç”¨æ³•

ç°åœ¨ä½ èƒ½åˆ›å»ºè‡ªå·±çš„"ä»£ç æœºå™¨"äº†ï¼ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æƒ³è®©ç¨‹åºæ ¹æ®ä¸åŒæƒ…å†µåšä¸åŒçš„äº‹æƒ…å‘¢ï¼Ÿæ¯”å¦‚ï¼Œåªç»™VIPç”¨æˆ·æ˜¾ç¤ºç‰¹æ®Šæ¬¢è¿ä¿¡æ¯ï¼Ÿ

è¿™å°±éœ€è¦å­¦ä¹ **æ¡ä»¶åˆ¤æ–­**â€”â€”è®©æˆ‘ä»¬è¿›å…¥ç¬¬3ç« ï¼Œå­¦ä¹ å¦‚ä½•è®©ç¨‹åºä¼š"æ€è€ƒ"ï¼

---

### ç¬¬3ç« ï¼šæ§åˆ¶æµç¨‹ - è®©ç¨‹åºä¼š"æ€è€ƒ"

ç¨‹åºä¸ä»…è¦èƒ½å­˜å‚¨æ•°æ®ã€æ‰§è¡Œå‡½æ•°ï¼Œè¿˜è¦èƒ½æ ¹æ®ä¸åŒæƒ…å†µåšå‡ºä¸åŒçš„å†³å®šã€‚è¿™å°±æ˜¯æ§åˆ¶æµç¨‹çš„ä½œç”¨ã€‚

#### 3.1 æ¡ä»¶åˆ¤æ–­ - ç¨‹åºçš„å†³ç­–èƒ½åŠ›

> ğŸ¤” **é—®é¢˜**ï¼šå¦‚ä½•è®©ç¨‹åºæ ¹æ®ä¸åŒæƒ…å†µåšä¸åŒçš„äº‹ï¼Ÿæ¯”å¦‚ï¼Œåªæœ‰é€‰ä¸­ç¬”è®°æ—¶æ‰å¤„ç†ï¼Œæ²¡é€‰ä¸­æ—¶æç¤ºç”¨æˆ·ï¼Ÿ

**ç”Ÿæ´»ä¾‹å­**ï¼šå‡ºé—¨å‰çœ‹å¤©æ°”
- å¦‚æœä¸‹é›¨ â†’ å¸¦ä¼
- å¦‚æœä¸ä¸‹é›¨ â†’ ä¸å¸¦ä¼

**ä»£ç å®ç°**ï¼š
```javascript
// åŸºç¡€çš„ if...else
let note = MNNote.getFocusNote();

if (note) {
  // æœ‰ç¬”è®°æ—¶æ‰§è¡Œè¿™é‡Œ
  MNUtil.showHUD("æ‰¾åˆ°ç¬”è®°ï¼š" + note.noteTitle);
} else {
  // æ²¡æœ‰ç¬”è®°æ—¶æ‰§è¡Œè¿™é‡Œ
  MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç¬”è®°");
}
```

**å¤šé‡æ¡ä»¶åˆ¤æ–­**ï¼š
```javascript
let note = MNNote.getFocusNote();

if (!note) {
  MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ç¬”è®°");
} else if (note.noteTitle === "") {
  MNUtil.showHUD("ç¬”è®°æ ‡é¢˜ä¸ºç©º");
} else if (note.noteTitle.length > 50) {
  MNUtil.showHUD("æ ‡é¢˜å¤ªé•¿äº†ï¼");
} else {
  MNUtil.showHUD("ç¬”è®°æ­£å¸¸ï¼š" + note.noteTitle);
}
```

**å®æˆ˜åº”ç”¨**ï¼š
```javascript
// æ¥è‡ª MarginNote æ’ä»¶çš„å®é™…é€»è¾‘
function checkAndProcessNote() {
  let focusNote = MNNote.getFocusNote();
  
  if (focusNote === null) {
    MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç¬”è®°");
    return;  // æå‰ç»“æŸå‡½æ•°
  }
  
  if (focusNote.colorIndex === 0) {
    focusNote.colorIndex = 3;  // è®¾ç½®ä¸ºçº¢è‰²
    MNUtil.showHUD("ç¬”è®°å·²æ ‡è®°ä¸ºçº¢è‰²");
  } else {
    MNUtil.showHUD("ç¬”è®°å·²ç»æœ‰é¢œè‰²äº†");
  }
}
```

**ğŸ¯ ç»ƒä¹ **ï¼šå†™ä¸€ä¸ªå‡½æ•°ï¼Œæ£€æŸ¥ç¬”è®°æ ‡é¢˜é•¿åº¦ï¼Œè¶…è¿‡20å­—ç¬¦å°±æç¤º"æ ‡é¢˜å¤ªé•¿"ã€‚

#### 3.2 å¾ªç¯ç»“æ„ - é‡å¤æ‰§è¡Œçš„é­”æ³•

> ğŸ¤” **é—®é¢˜**ï¼šå¦‚æœæˆ‘æƒ³ç»™100ä¸ªç¬”è®°éƒ½æ·»åŠ ç›¸åŒçš„æ ‡ç­¾ï¼Œéš¾é“è¦å†™100æ¬¡ä»£ç å—ï¼Ÿ

**å¾ªç¯å°±åƒä¼ é€å¸¦**ï¼šè®©åŒæ ·çš„æ“ä½œé‡å¤æ‰§è¡Œå¤šæ¬¡ã€‚

**åŸºç¡€ for å¾ªç¯**ï¼š
```javascript
// æœ€ç®€å•çš„ä¾‹å­ï¼šæ•°æ•°
for (let i = 1; i <= 5; i++) {
  MNUtil.showHUD("ç¬¬ " + i + " æ¬¡å¾ªç¯");
}
// è¾“å‡ºï¼šç¬¬1æ¬¡å¾ªç¯ã€ç¬¬2æ¬¡å¾ªç¯ã€ç¬¬3æ¬¡å¾ªç¯ã€ç¬¬4æ¬¡å¾ªç¯ã€ç¬¬5æ¬¡å¾ªç¯

// å®é™…åº”ç”¨ï¼šæ‰¹é‡å¤„ç†ç¬”è®°
let notes = MNNote.getFocusNotes();  // è·å–é€‰ä¸­çš„å¤šä¸ªç¬”è®°

for (let i = 0; i < notes.length; i++) {
  let note = notes[i];  // å–å‡ºç¬¬iä¸ªç¬”è®°
  note.colorIndex = 3;  // è®¾ç½®é¢œè‰²
  MNUtil.showHUD("å¤„ç†ç¬¬ " + (i+1) + " ä¸ªç¬”è®°");
}
```

**ä»£ç è§£é‡Š**ï¼š
- `let i = 0` â†’ è®¡æ•°å™¨ä»0å¼€å§‹
- `i < notes.length` â†’ åªè¦æ²¡å¤„ç†å®Œå°±ç»§ç»­
- `i++` â†’ æ¯æ¬¡å¾ªç¯åè®¡æ•°å™¨+1
- `notes[i]` â†’ ç”¨ä¸‹æ ‡è®¿é—®æ•°ç»„ä¸­çš„ç¬”è®°

**æ›´ç°ä»£çš„å†™æ³• - for...of å¾ªç¯**ï¼š
```javascript
let notes = MNNote.getFocusNotes();

for (let note of notes) {  // ç›´æ¥éå†æ¯ä¸ªç¬”è®°
  note.colorIndex = 3;
  MNUtil.showHUD("å¤„ç†ç¬”è®°ï¼š" + note.noteTitle);
}
// æ›´ç®€æ´ï¼Œä¸éœ€è¦ç®¡ä¸‹æ ‡
```

**ğŸ¯ ç»ƒä¹ **ï¼šå†™ä¸€ä¸ªå¾ªç¯ï¼Œç»™æ•°ç»„ä¸­çš„æ¯ä¸ªæ•°å­—éƒ½ä¹˜ä»¥2ã€‚

#### 3.3 å®æˆ˜ç»ƒä¹ ï¼šæ‰¹é‡å¤„ç†ç¬”è®°

> ğŸ¤” **é—®é¢˜**ï¼šç°åœ¨ä½ å·²ç»å­¦ä¼šäº†æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ï¼Œèƒ½ä¸èƒ½ç»¼åˆè¿ç”¨ï¼Œå†™ä¸€ä¸ªæ‰¹é‡å¤„ç†ç¬”è®°çš„åŠŸèƒ½ï¼Ÿ

**éœ€æ±‚**ï¼šåªå¤„ç†æœ‰æ ‡é¢˜çš„ç¬”è®°ï¼Œç»™å®ƒä»¬éƒ½åŠ ä¸Šçº¢è‰²æ ‡è®°ã€‚

```javascript
function batchProcessNotes() {
  let notes = MNNote.getFocusNotes();  // è·å–é€‰ä¸­çš„ç¬”è®°
  let processedCount = 0;              // è®¡æ•°å™¨
  
  // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„ç¬”è®°
  if (notes.length === 0) {
    MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ç¬”è®°");
    return;
  }
  
  // éå†æ¯ä¸ªç¬”è®°
  for (let note of notes) {
    // æ¡ä»¶åˆ¤æ–­ï¼šåªå¤„ç†æœ‰æ ‡é¢˜çš„ç¬”è®°
    if (note.noteTitle && note.noteTitle.trim() !== "") {
      note.colorIndex = 3;  // è®¾ç½®ä¸ºçº¢è‰²
      processedCount++;     // è®¡æ•°å™¨+1
    }
  }
  
  // æ˜¾ç¤ºå¤„ç†ç»“æœ
  MNUtil.showHUD("å·²å¤„ç† " + processedCount + " ä¸ªæœ‰æ ‡é¢˜çš„ç¬”è®°");
}

// ä½¿ç”¨å‡½æ•°
batchProcessNotes();
```

**ä»£ç åˆ†æ**ï¼š
1. **å‡½æ•°å°è£…**ï¼šæŠŠåŠŸèƒ½åŒ…è£…æˆå‡½æ•°ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨
2. **é”™è¯¯æ£€æŸ¥**ï¼šå…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç¬”è®°å¯å¤„ç†
3. **å¾ªç¯éå†**ï¼šç”¨ for...of éå†æ‰€æœ‰ç¬”è®°
4. **æ¡ä»¶ç­›é€‰**ï¼šåªå¤„ç†ç¬¦åˆæ¡ä»¶çš„ç¬”è®°
5. **ç»“æœåé¦ˆ**ï¼šå‘Šè¯‰ç”¨æˆ·å¤„ç†äº†å¤šå°‘ä¸ªç¬”è®°

---

### ç¬¬3ç« å°ç»“

æ­å–œï¼ä½ å·²ç»æŒæ¡äº†ç¨‹åºçš„"å¤§è„‘"ï¼š
âœ… ç”¨ if...else è®©ç¨‹åºåšåˆ¤æ–­
âœ… ç”¨å¾ªç¯æ‰¹é‡å¤„ç†æ•°æ®
âœ… ç»¼åˆè¿ç”¨å‡½æ•°ã€æ¡ä»¶ã€å¾ªç¯è§£å†³å®é™…é—®é¢˜

ç°åœ¨ä½ çš„ç¨‹åºå·²ç»ä¼š"æ€è€ƒ"äº†ï¼ä½†æ˜¯ï¼Œå¦‚æœè¦å¤„ç†æ›´å¤æ‚çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿæœ‰å§“åã€å¹´é¾„ã€æˆç»©ç­‰å¤šä¸ªå±æ€§ï¼Ÿ

è¿™å°±éœ€è¦å­¦ä¹ **å¤åˆæ•°æ®ç±»å‹**â€”â€”è®©æˆ‘ä»¬è¿›å…¥ç¬¬4ç« ï¼

---

### ç¬¬4ç« ï¼šå¤åˆæ•°æ®ç±»å‹ - å¤„ç†å¤æ‚ä¿¡æ¯

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç”¨çš„éƒ½æ˜¯ç®€å•æ•°æ®ï¼šä¸€ä¸ªå˜é‡å­˜ä¸€ä¸ªå€¼ã€‚ä½†ç°å®ä¸–ç•Œçš„ä¿¡æ¯å¾€å¾€å¾ˆå¤æ‚ï¼šä¸€ä¸ªç¬”è®°æœ‰æ ‡é¢˜ã€å†…å®¹ã€é¢œè‰²ã€è¯„è®ºç­‰å¤šä¸ªå±æ€§ã€‚è¿™å°±éœ€è¦å¤åˆæ•°æ®ç±»å‹ã€‚

#### 4.1 æ•°ç»„ - ç®¡ç†å¤šä¸ªæ•°æ®

> ğŸ¤” **é—®é¢˜**ï¼šå¦‚æœæˆ‘æƒ³å­˜å‚¨å¤šä¸ªç”¨æˆ·çš„åå­—ï¼Œéš¾é“è¦åˆ›å»º name1ã€name2ã€name3... è¿™æ ·çš„å˜é‡å—ï¼Ÿ

**æ•°ç»„å°±åƒä¸€ä¸ªæœ‰åºçš„æ”¶çº³ç›’**ï¼šå¯ä»¥æ”¾å¤šä¸ªä¸œè¥¿ï¼Œæ¯ä¸ªä½ç½®éƒ½æœ‰ç¼–å·ã€‚

**åŸºç¡€ç”¨æ³•**ï¼š
```javascript
// åˆ›å»ºæ•°ç»„çš„å‡ ç§æ–¹æ³•
let userNames = ["å°æ˜", "å°çº¢", "å°åˆš"];        // ç›´æ¥åˆ›å»º
let scores = [85, 92, 78];                    // æ•°å­—æ•°ç»„
let mixedArray = ["å°æ˜", 18, true, null];    // æ··åˆç±»å‹æ•°ç»„
let emptyArray = [];                          // ç©ºæ•°ç»„

// è®¿é—®æ•°ç»„å…ƒç´ ï¼ˆä¸‹æ ‡ä»0å¼€å§‹ï¼‰
MNUtil.showHUD("ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼š" + userNames[0]);  // å°æ˜
MNUtil.showHUD("ç¬¬äºŒä¸ªç”¨æˆ·ï¼š" + userNames[1]);  // å°çº¢
MNUtil.showHUD("æ•°ç»„é•¿åº¦ï¼š" + userNames.length); // 3
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```javascript
// MarginNote ä¸­çš„å®é™…ä¾‹å­ï¼šæ‰¹é‡å¤„ç†ç¬”è®°
function colorNotesByCategory() {
  let notes = MNNote.getFocusNotes();    // è·å–é€‰ä¸­ç¬”è®°ï¼ˆè¿™å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ï¼‰
  let colors = [1, 2, 3, 4, 5];          // å‡†å¤‡5ç§é¢œè‰²
  
  for (let i = 0; i < notes.length; i++) {
    let colorIndex = colors[i % colors.length];  // è½®æµä½¿ç”¨é¢œè‰²
    notes[i].colorIndex = colorIndex;
    MNUtil.showHUD("ç¬”è®° " + (i+1) + " è®¾ä¸ºé¢œè‰² " + colorIndex);
  }
}
```

**å¸¸ç”¨æ•°ç»„æ“ä½œ**ï¼š
```javascript
let fruits = ["è‹¹æœ", "é¦™è•‰"];

// æ·»åŠ å…ƒç´ 
fruits.push("æ©™å­");           // åœ¨æœ«å°¾æ·»åŠ ï¼š["è‹¹æœ", "é¦™è•‰", "æ©™å­"]
fruits.unshift("è‰è“");        // åœ¨å¼€å¤´æ·»åŠ ï¼š["è‰è“", "è‹¹æœ", "é¦™è•‰", "æ©™å­"]

// åˆ é™¤å…ƒç´ 
let lastFruit = fruits.pop();  // åˆ é™¤æœ€åä¸€ä¸ªï¼šæ©™å­
let firstFruit = fruits.shift(); // åˆ é™¤ç¬¬ä¸€ä¸ªï¼šè‰è“

// æŸ¥æ‰¾å…ƒç´ 
let index = fruits.indexOf("è‹¹æœ");  // æ‰¾åˆ°è‹¹æœçš„ä½ç½®ï¼š0
let hasApple = fruits.includes("è‹¹æœ"); // æ£€æŸ¥æ˜¯å¦åŒ…å«è‹¹æœï¼štrue

MNUtil.log("å½“å‰æ°´æœï¼š" + fruits);  // ["è‹¹æœ", "é¦™è•‰"]
```

**ğŸ¯ å®æˆ˜ç»ƒä¹ **ï¼š
```javascript
// åˆ›å»ºä¸€ä¸ªç¬”è®°æ ‡é¢˜æ¸…ç†å™¨
function cleanNoteTitles() {
  let notes = MNNote.getFocusNotes();
  let cleanedTitles = [];  // å­˜å‚¨æ¸…ç†åçš„æ ‡é¢˜
  
  for (let note of notes) {
    if (note.noteTitle) {
      // æ¸…ç†æ ‡é¢˜ï¼šå»é™¤å‰åç©ºæ ¼ï¼Œç§»é™¤ç‰¹æ®Šå­—ç¬¦
      let cleanTitle = note.noteTitle.trim().replace(/[^\w\s]/g, '');
      cleanedTitles.push(cleanTitle);
      note.noteTitle = cleanTitle;
    }
  }
  
  MNUtil.showHUD("æ¸…ç†äº† " + cleanedTitles.length + " ä¸ªæ ‡é¢˜");
  MNUtil.log("æ¸…ç†åçš„æ ‡é¢˜ï¼š" + cleanedTitles);
}
```

#### 4.2 å¯¹è±¡ - ç®¡ç†ç»“æ„åŒ–æ•°æ®

> ğŸ¤” **é—®é¢˜**ï¼šæ•°ç»„é€‚åˆå­˜å‚¨ç›¸åŒç±»å‹çš„å¤šä¸ªæ•°æ®ï¼Œä½†å¦‚æœä¸€ä¸ªç¬”è®°æœ‰æ ‡é¢˜ã€å†…å®¹ã€é¢œè‰²ã€åˆ›å»ºæ—¶é—´ç­‰ä¸åŒç±»å‹çš„å±æ€§å‘¢ï¼Ÿ

**å¯¹è±¡å°±åƒä¸€ä¸ªæœ‰æ ‡ç­¾çš„å‚¨ç‰©æŸœ**ï¼šæ¯ä¸ªæ ¼å­éƒ½æœ‰è‡ªå·±çš„åå­—ã€‚

**åŸºç¡€ç”¨æ³•**ï¼š
```javascript
// åˆ›å»ºå¯¹è±¡
let student = {
  name: "å°æ˜",
  age: 18,
  grade: "é«˜ä¸‰",
  subjects: ["æ•°å­¦", "ç‰©ç†", "åŒ–å­¦"]  // å¯¹è±¡é‡Œå¯ä»¥åŒ…å«æ•°ç»„
};

// è®¿é—®å¯¹è±¡å±æ€§
MNUtil.showHUD("å§“åï¼š" + student.name);        // å°æ˜
MNUtil.showHUD("å¹´é¾„ï¼š" + student.age);         // 18
MNUtil.showHUD("å­¦ç§‘ï¼š" + student.subjects[0]); // æ•°å­¦
```

**MarginNote ä¸­çš„å®é™…åº”ç”¨**ï¼š
```javascript
// åˆ›å»ºä¸€ä¸ªç¬”è®°ä¿¡æ¯å¯¹è±¡
function getNoteInfo() {
  let note = MNNote.getFocusNote();
  if (!note) return null;
  
  let noteInfo = {
    title: note.noteTitle || "æ— æ ‡é¢˜",
    content: note.textContent || "æ— å†…å®¹", 
    color: note.colorIndex || 0,
    hasComments: note.comments && note.comments.length > 0,
    created: new Date().toLocaleString(),
    // æ–¹æ³•ï¼šå¯¹è±¡ä¹Ÿå¯ä»¥åŒ…å«å‡½æ•°
    display: function() {
      MNUtil.showHUD("ç¬”è®°ï¼š" + this.title + " (" + this.color + ")");
    }
  };
  
  return noteInfo;
}

// ä½¿ç”¨
let info = getNoteInfo();
if (info) {
  info.display();  // è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•
  MNUtil.log(info); // æŸ¥çœ‹å®Œæ•´ä¿¡æ¯
}
```

**å¯¹è±¡æ“ä½œ**ï¼š
```javascript
let config = {
  theme: "dark",
  fontSize: 14
};

// æ·»åŠ æ–°å±æ€§
config.language = "zh-CN";
config["auto-save"] = true;  // å±æ€§åæœ‰ç‰¹æ®Šå­—ç¬¦æ—¶ç”¨è¿™ç§æ–¹å¼

// ä¿®æ”¹å±æ€§
config.fontSize = 16;

// åˆ é™¤å±æ€§
delete config.theme;

// æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨
if ("language" in config) {
  MNUtil.showHUD("è¯­è¨€è®¾ç½®ï¼š" + config.language);
}

// éå†å¯¹è±¡å±æ€§
for (let key in config) {
  MNUtil.log(key + ": " + config[key]);
}
```

#### 4.3 ç‰¹æ®Šå€¼å¤„ç†

##### undefined å’Œ null - åˆå­¦è€…æœ€å›°æƒ‘çš„æ¦‚å¿µ

è¿™ä¸¤ä¸ªéƒ½è¡¨ç¤º"æ²¡æœ‰å€¼"ï¼Œä½†ç”¨æ³•ä¸åŒï¼š

```javascript
// undefinedï¼šç³»ç»Ÿè¯´"æˆ‘ä¸çŸ¥é“"
let userName;                    // å£°æ˜äº†ä½†æ²¡èµ‹å€¼
MNUtil.log(userName);           // undefined

let note = MNNote.getFocusNote();
if (!note) {
  MNUtil.log("æ²¡æœ‰é€‰ä¸­ç¬”è®°");      // note å¯èƒ½æ˜¯ null
}

// nullï¼šç¨‹åºå‘˜è¯´"è¿™é‡Œæ•…æ„ç©ºç€"
let settings = {
  theme: "dark",
  language: "zh-CN", 
  customCSS: null    // æ•…æ„è®¾ä¸ºç©ºï¼Œè¡¨ç¤º"æš‚æ—¶æ²¡æœ‰è‡ªå®šä¹‰æ ·å¼"
};
```

**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
- **undefined**ï¼šå°±åƒé—®"ä½ ä»Šå¤©åƒäº†ä»€ä¹ˆï¼Ÿ"ï¼Œå¯¹æ–¹è¯´"æˆ‘å¿˜äº†"ï¼ˆç³»ç»Ÿä¸çŸ¥é“ï¼‰
- **null**ï¼šå°±åƒé—®"ä½ ä»Šå¤©åƒäº†ä»€ä¹ˆï¼Ÿ"ï¼Œå¯¹æ–¹è¯´"æˆ‘æ²¡åƒ"ï¼ˆä¸»åŠ¨å‘Šè¯‰ä½ æ˜¯ç©ºçš„ï¼‰

**åœ¨ MarginNote æ’ä»¶ä¸­çš„å®é™…åº”ç”¨**ï¼š

```javascript
// æ£€æŸ¥ç¬”è®°æ˜¯å¦å­˜åœ¨
let focusNote = MNNote.getFocusNote();
if (focusNote === null) {
  MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç¬”è®°");
  return;
}

// æ£€æŸ¥å±æ€§æ˜¯å¦å®šä¹‰
if (typeof focusNote.customProperty === "undefined") {
  focusNote.customProperty = "é»˜è®¤å€¼";
}

// æ¸…ç©ºæŸä¸ªå±æ€§ï¼ˆè®¾ç½®ä¸º nullï¼‰
focusNote.tempData = null;  // ä¸»åŠ¨æ¸…ç©ºä¸´æ—¶æ•°æ®
```

**å¸¸è§é”™è¯¯å’Œæ­£ç¡®å¤„ç†**ï¼š

```javascript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨å¯èƒ½ä¸º undefined çš„å€¼
let note = MNNote.getFocusNote();
note.appendComment("æ–°è¯„è®º");  // å¦‚æœ note æ˜¯ nullï¼Œä¼šæŠ¥é”™ï¼

// âœ… æ­£ç¡®ï¼šå…ˆæ£€æŸ¥å†ä½¿ç”¨
let note = MNNote.getFocusNote();
if (note) {  // åŒæ—¶æ£€æŸ¥ null å’Œ undefined
  note.appendComment("æ–°è¯„è®º");
} else {
  MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ç¬”è®°");
}

// âœ… æ›´ç®€æ´çš„å†™æ³•ï¼šå¯é€‰é“¾æ“ä½œç¬¦ï¼ˆå¦‚æœæ”¯æŒï¼‰
note?.appendComment("æ–°è¯„è®º");  // åªæœ‰ note å­˜åœ¨æ—¶æ‰è°ƒç”¨
```

**è®°å¿†æŠ€å·§**ï¼š
- **undefined**ï¼š"æˆ‘ä¸çŸ¥é“" - ç³»ç»Ÿæ²¡ç»™å€¼
- **null**ï¼š"æˆ‘çŸ¥é“æ˜¯ç©ºçš„" - ç¨‹åºå‘˜ä¸»åŠ¨è®¾ç©º

#### 4.4 ç»¼åˆç»ƒä¹ ï¼šåˆ›å»ºç¬”è®°ç®¡ç†å™¨

> ğŸ¯ **æŒ‘æˆ˜**ï¼šç»¼åˆè¿ç”¨æ•°ç»„ã€å¯¹è±¡å’Œç‰¹æ®Šå€¼å¤„ç†ï¼Œåˆ›å»ºä¸€ä¸ªå°å‹ç¬”è®°ç®¡ç†ç³»ç»Ÿ

```javascript
function createNoteManager() {
  // ç¬”è®°ç®¡ç†å™¨å¯¹è±¡
  let noteManager = {
    notes: [],  // å­˜å‚¨æ‰€æœ‰ç¬”è®°ä¿¡æ¯
    
    // æ·»åŠ ç¬”è®°
    addNote: function(title, content) {
      if (!title || title.trim() === "") {
        MNUtil.showHUD("æ ‡é¢˜ä¸èƒ½ä¸ºç©º");
        return null;
      }
      
      let noteInfo = {
        id: this.notes.length + 1,
        title: title.trim(),
        content: content || "",
        created: new Date().toLocaleString(),
        color: 0
      };
      
      this.notes.push(noteInfo);
      return noteInfo;
    },
    
    // æŸ¥æ‰¾ç¬”è®°
    findNote: function(id) {
      for (let note of this.notes) {
        if (note.id === id) {
          return note;
        }
      }
      return null;  // æ²¡æ‰¾åˆ°è¿”å› null
    },
    
    // æ˜¾ç¤ºæ‰€æœ‰ç¬”è®°
    listNotes: function() {
      if (this.notes.length === 0) {
        MNUtil.showHUD("è¿˜æ²¡æœ‰ç¬”è®°");
        return;
      }
      
      for (let note of this.notes) {
        MNUtil.log("ID:" + note.id + " | " + note.title + " | " + note.created);
      }
    }
  };
  
  return noteManager;
}

// ä½¿ç”¨ç¤ºä¾‹
let manager = createNoteManager();
manager.addNote("å­¦ä¹ JavaScript", "ä»Šå¤©å­¦ä¹ äº†æ•°ç»„å’Œå¯¹è±¡");
manager.addNote("MarginNoteæŠ€å·§", "å­¦ä¼šäº†æ‰¹é‡å¤„ç†ç¬”è®°");
manager.listNotes();

let note = manager.findNote(1);
if (note) {
  MNUtil.showHUD("æ‰¾åˆ°ç¬”è®°ï¼š" + note.title);
} else {
  MNUtil.showHUD("ç¬”è®°ä¸å­˜åœ¨");
}
```

---

### ç¬¬4ç« å°ç»“

ğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº†å¤„ç†å¤æ‚æ•°æ®çš„æ ¸å¿ƒæŠ€èƒ½ï¼š

âœ… **æ•°ç»„æ“ä½œ**ï¼šå­˜å‚¨å’Œæ“ä½œå¤šä¸ªæ•°æ®
- åˆ›å»ºæ•°ç»„ï¼š`let arr = [1, 2, 3]`
- è®¿é—®å…ƒç´ ï¼š`arr[0]`ï¼Œè·å–é•¿åº¦ï¼š`arr.length`
- æ·»åŠ /åˆ é™¤ï¼š`push()`, `pop()`, `shift()`, `unshift()`
- æŸ¥æ‰¾ï¼š`indexOf()`, `includes()`

âœ… **å¯¹è±¡æ“ä½œ**ï¼šç®¡ç†ç»“æ„åŒ–æ•°æ®
- åˆ›å»ºå¯¹è±¡ï¼š`let obj = {name: "å°æ˜", age: 18}`
- è®¿é—®å±æ€§ï¼š`obj.name` æˆ– `obj["name"]`
- æ·»åŠ /åˆ é™¤å±æ€§ï¼š`obj.newProp = value`, `delete obj.prop`
- éå†å±æ€§ï¼š`for...in` å¾ªç¯

âœ… **ç‰¹æ®Šå€¼å¤„ç†**ï¼šé¿å…å¸¸è§é”™è¯¯
- `undefined`ï¼šç³»ç»Ÿæœªå®šä¹‰çš„å€¼
- `null`ï¼šç¨‹åºå‘˜ä¸»åŠ¨è®¾ç½®çš„ç©ºå€¼
- å®‰å…¨æ£€æŸ¥ï¼š`if (value)` æˆ–å¯é€‰é“¾ `value?.method()`

ç°åœ¨ä½ å¯ä»¥å¤„ç†çœŸå®ä¸–ç•Œä¸­çš„å¤æ‚æ•°æ®äº†ï¼ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æƒ³è®©æ•°æ®æœ‰"è¡Œä¸º"å‘¢ï¼Ÿæ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿå¯¹è±¡ä¸ä»…æœ‰å±æ€§ï¼Œè¿˜èƒ½"è‡ªæˆ‘ä»‹ç»"ã€"è®¡ç®—GPA"ç­‰ï¼Ÿ

è¿™å°±éœ€è¦å­¦ä¹ **é¢å‘å¯¹è±¡ç¼–ç¨‹**â€”â€”è®©æˆ‘ä»¬è¿›å…¥ç¬¬äºŒéƒ¨åˆ†ï¼

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å­¦ä¼šäº†æ•°æ®ç±»å‹ã€å‡½æ•°å’Œæ§åˆ¶æµç¨‹ã€‚ç°åœ¨æ˜¯æ—¶å€™å­¦ä¹ **é¢å‘å¯¹è±¡ç¼–ç¨‹**äº†â€”â€”è®©æ•°æ®ä¸ä»…æœ‰"å±æ€§"ï¼Œè¿˜æœ‰"è¡Œä¸º"ã€‚

### ç¬¬5ç« ï¼šç±»ä¸å¯¹è±¡ - æ•°æ®çš„è¿›åŒ–

> ğŸ¤” **é—®é¢˜**ï¼šæˆ‘ä»¬å­¦äº†å¯¹è±¡ï¼ˆæ¯”å¦‚ `{name: "å°æ˜", age: 18}`ï¼‰ï¼Œä½†å¦‚æœæˆ‘è¦åˆ›å»ºå¾ˆå¤šä¸ªå­¦ç”Ÿå¯¹è±¡ï¼Œéš¾é“è¦ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨å†™å—ï¼Ÿ

#### 5.1 ä»ç®€å•å¯¹è±¡åˆ°ç±»

**å›é¡¾**ï¼šæˆ‘ä»¬ä¹‹å‰åˆ›å»ºå¯¹è±¡æ˜¯è¿™æ ·çš„ï¼š
```javascript
// æ‰‹åŠ¨åˆ›å»ºå­¦ç”Ÿå¯¹è±¡
let student1 = {
  name: "å°æ˜",
  age: 18,
  grade: "é«˜ä¸‰",
  introduce: function() {
    MNUtil.showHUD("æˆ‘æ˜¯ " + this.name + "ï¼Œä»Šå¹´ " + this.age + " å²");
  }
};

let student2 = {
  name: "å°çº¢", 
  age: 17,
  grade: "é«˜äºŒ",
  introduce: function() {  // é‡å¤çš„ä»£ç ï¼
    MNUtil.showHUD("æˆ‘æ˜¯ " + this.name + "ï¼Œä»Šå¹´ " + this.age + " å²");
  }
};
```

**é—®é¢˜**ï¼šä»£ç é‡å¤ï¼Œä¸å¥½ç»´æŠ¤ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ç±»ï¼ˆClassï¼‰
```javascript
// ç±»å°±åƒä¸€ä¸ª"å­¦ç”Ÿæ¨¡æ¿"
class Student {
  // æ„é€ å‡½æ•°ï¼šåˆ›å»ºå­¦ç”Ÿæ—¶è‡ªåŠ¨è°ƒç”¨
  constructor(name, age, grade) {
    this.name = name;
    this.age = age; 
    this.grade = grade;
  }
  
  // æ–¹æ³•ï¼šæ‰€æœ‰å­¦ç”Ÿéƒ½èƒ½åšçš„äº‹
  introduce() {
    MNUtil.showHUD("æˆ‘æ˜¯ " + this.name + "ï¼Œä»Šå¹´ " + this.age + " å²");
  }
  
  study(subject) {
    MNUtil.showHUD(this.name + " æ­£åœ¨å­¦ä¹  " + subject);
  }
}

// ä½¿ç”¨ç±»åˆ›å»ºå¯¹è±¡ï¼ˆå®ä¾‹åŒ–ï¼‰
let student1 = new Student("å°æ˜", 18, "é«˜ä¸‰");
let student2 = new Student("å°çº¢", 17, "é«˜äºŒ");

student1.introduce();  // æˆ‘æ˜¯ å°æ˜ï¼Œä»Šå¹´ 18 å²
student2.study("æ•°å­¦"); // å°çº¢ æ­£åœ¨å­¦ä¹  æ•°å­¦
```

#### 5.2 MarginNote ä¸­çš„ç±»åº”ç”¨

è®©æˆ‘ä»¬çœ‹çœ‹ MarginNote æ’ä»¶ä¸­å¦‚ä½•ä½¿ç”¨ç±»ï¼š

```javascript
// åˆ›å»ºä¸€ä¸ªç¬”è®°å¤„ç†å™¨ç±»
class NoteProcessor {
  constructor(pluginName) {
    this.pluginName = pluginName;
    this.processedCount = 0;
  }
  
  // å¤„ç†å•ä¸ªç¬”è®°
  processNote(note) {
    if (!note || !note.noteTitle) {
      return false;
    }
    
    // æ¸…ç†æ ‡é¢˜
    note.noteTitle = note.noteTitle.trim();
    // è®¾ç½®é¢œè‰²
    note.colorIndex = 2;
    // è®¡æ•°
    this.processedCount++;
    
    return true;
  }
  
  // æ‰¹é‡å¤„ç†ç¬”è®°
  processBatch() {
    let notes = MNNote.getFocusNotes();
    this.processedCount = 0;  // é‡ç½®è®¡æ•°
    
    for (let note of notes) {
      this.processNote(note);
    }
    
    MNUtil.showHUD(this.pluginName + " å¤„ç†äº† " + this.processedCount + " ä¸ªç¬”è®°");
  }
  
  // è·å–å¤„ç†ç»Ÿè®¡
  getStats() {
    return {
      plugin: this.pluginName,
      processed: this.processedCount,
      lastUpdate: new Date().toLocaleString()
    };
  }
}

// ä½¿ç”¨ç±»
let processor = new NoteProcessor("æˆ‘çš„ç¬”è®°å¤„ç†å™¨");
processor.processBatch();
let stats = processor.getStats();
MNUtil.log(stats);
```

#### 5.3 getter å’Œ setter - å±æ€§çš„å®ˆé—¨å‘˜

> ğŸ¤” **é—®é¢˜**ï¼šå¦‚æœæˆ‘æƒ³è®©å±æ€§æœ‰ä¸€äº›"æ™ºèƒ½è¡Œä¸º"å‘¢ï¼Ÿæ¯”å¦‚è®¾ç½®å¹´é¾„æ—¶è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦åˆæ³•ï¼Ÿ

**getter å’Œ setter è®©å±æ€§å˜å¾—"èªæ˜"**ï¼š
```javascript
class SmartStudent {
  constructor(name, age) {
    this.name = name;
    this._age = age;  // ç”¨ _ è¡¨ç¤º"å†…éƒ¨å±æ€§"
  }
  
  // getterï¼šè¯»å–å±æ€§æ—¶è°ƒç”¨
  get age() {
    return this._age;
  }
  
  // setterï¼šè®¾ç½®å±æ€§æ—¶è°ƒç”¨ 
  set age(value) {
    if (value < 0 || value > 150) {
      MNUtil.showHUD("å¹´é¾„ä¸åˆæ³•ï¼š" + value);
      return;
    }
    this._age = value;
    MNUtil.showHUD("å¹´é¾„å·²æ›´æ–°ä¸ºï¼š" + value);
  }
  
  // è®¡ç®—å±æ€§ï¼šæ¯æ¬¡è®¿é—®éƒ½é‡æ–°è®¡ç®—
  get description() {
    return this.name + "ï¼ˆ" + this._age + "å²ï¼‰";
  }
}

// ä½¿ç”¨
let student = new SmartStudent("å°æ˜", 18);
MNUtil.log(student.age);          // 18ï¼ˆè°ƒç”¨getterï¼‰
student.age = 19;                 // è°ƒç”¨setterï¼Œæ˜¾ç¤º"å¹´é¾„å·²æ›´æ–°ä¸ºï¼š19"
student.age = -5;                 // è°ƒç”¨setterï¼Œæ˜¾ç¤º"å¹´é¾„ä¸åˆæ³•"ï¼Œä¸ä¼šæ›´æ–°
MNUtil.log(student.description);  // "å°æ˜ï¼ˆ19å²ï¼‰"ï¼ˆè°ƒç”¨getterï¼‰
```

**åœ¨ MarginNote ä¸­çš„åº”ç”¨**ï¼š

```javascript
class SmartNote {
  constructor(note) {
    this.note = note;
    this._priority = 0;
  }
  
  // æ™ºèƒ½æ ‡é¢˜å¤„ç†
  get title() {
    return this.note.noteTitle || "æ— æ ‡é¢˜";
  }
  
  set title(value) {
    if (!value || value.trim() === "") {
      MNUtil.showHUD("æ ‡é¢˜ä¸èƒ½ä¸ºç©º");
      return;
    }
    
    // è‡ªåŠ¨æ¸…ç†å’Œæ ¼å¼åŒ–æ ‡é¢˜
    let cleanTitle = value.trim().replace(/\s+/g, ' ');
    this.note.noteTitle = cleanTitle;
    MNUtil.showHUD("æ ‡é¢˜å·²è®¾ç½®ä¸ºï¼š" + cleanTitle);
  }
  
  // ä¼˜å…ˆçº§ç®¡ç†
  get priority() {
    return this._priority;
  }
  
  set priority(level) {
    if (level < 0 || level > 5) {
      MNUtil.showHUD("ä¼˜å…ˆçº§å¿…é¡»åœ¨0-5ä¹‹é—´");
      return;
    }
    
    this._priority = level;
    // æ ¹æ®ä¼˜å…ˆçº§è‡ªåŠ¨è®¾ç½®é¢œè‰²
    this.note.colorIndex = level;
    MNUtil.showHUD(`ä¼˜å…ˆçº§è®¾ä¸º ${level}ï¼Œé¢œè‰²å·²åŒæ­¥æ›´æ–°`);
  }
  
  // åªè¯»å±æ€§
  get info() {
    return `${this.title} [ä¼˜å…ˆçº§: ${this.priority}]`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let note = MNNote.getFocusNote();
if (note) {
  let smartNote = new SmartNote(note);
  
  smartNote.title = "   é‡è¦ç¬”è®°   ";  // è‡ªåŠ¨æ¸…ç†æ ¼å¼
  smartNote.priority = 3;             // è®¾ç½®ä¼˜å…ˆçº§å’Œé¢œè‰²
  MNUtil.log(smartNote.info);         // æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯
}
```
#### 5.4 å®æˆ˜ç»ƒä¹ ï¼šåˆ›å»ºç¬”è®°ç®¡ç†å™¨ç±»

> ğŸ¯ **æŒ‘æˆ˜**ï¼šç»¼åˆè¿ç”¨æ„é€ å‡½æ•°ã€æ–¹æ³•ã€getter/setterï¼Œåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ç¬”è®°ç®¡ç†ç³»ç»Ÿ

```javascript
class NoteManager {
  constructor() {
    this.notes = [];
    this.currentFilter = "all";
    this._totalProcessed = 0;
  }
  
  // æ·»åŠ ç¬”è®°
  addNote(title, content, priority = 0) {
    if (!title || title.trim() === "") {
      MNUtil.showHUD("æ ‡é¢˜ä¸èƒ½ä¸ºç©º");
      return null;
    }
    
    let note = {
      id: this.notes.length + 1,
      title: title.trim(),
      content: content || "",
      priority: Math.min(Math.max(priority, 0), 5), // é™åˆ¶åœ¨0-5èŒƒå›´
      created: new Date(),
      modified: new Date()
    };
    
    this.notes.push(note);
    this._totalProcessed++;
    return note;
  }
  
  // æŸ¥æ‰¾ç¬”è®°
  findById(id) {
    return this.notes.find(note => note.id === id) || null;
  }
  
  findByTitle(title) {
    return this.notes.filter(note => 
      note.title.toLowerCase().includes(title.toLowerCase())
    );
  }
  
  // è¿‡æ»¤å™¨ getter
  get filteredNotes() {
    switch (this.currentFilter) {
      case "high":
        return this.notes.filter(note => note.priority >= 4);
      case "medium":
        return this.notes.filter(note => note.priority >= 2 && note.priority < 4);
      case "low":
        return this.notes.filter(note => note.priority < 2);
      case "recent":
        let yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        return this.notes.filter(note => note.created > yesterday);
      default:
        return this.notes;
    }
  }
  
  // è®¾ç½®è¿‡æ»¤å™¨
  set filter(filterType) {
    let validFilters = ["all", "high", "medium", "low", "recent"];
    if (!validFilters.includes(filterType)) {
      MNUtil.showHUD("æ— æ•ˆçš„è¿‡æ»¤ç±»å‹: " + filterType);
      return;
    }
    
    this.currentFilter = filterType;
    MNUtil.showHUD("è¿‡æ»¤å™¨è®¾ä¸ºï¼š" + filterType);
  }
  
  // ç»Ÿè®¡ä¿¡æ¯ getter
  get stats() {
    return {
      total: this.notes.length,
      high: this.notes.filter(n => n.priority >= 4).length,
      medium: this.notes.filter(n => n.priority >= 2 && n.priority < 4).length,
      low: this.notes.filter(n => n.priority < 2).length,
      processed: this._totalProcessed
    };
  }
  
  // æ˜¾ç¤ºç¬”è®°åˆ—è¡¨
  displayNotes() {
    let notes = this.filteredNotes;
    if (notes.length === 0) {
      MNUtil.showHUD("æ²¡æœ‰æ‰¾åˆ°ç¬”è®°");
      return;
    }
    
    for (let note of notes) {
      let priority = "â˜…".repeat(note.priority) || "â˜†";
      MNUtil.log(`${priority} ${note.title} (${note.created.toLocaleDateString()})`);
    }
    
    let stats = this.stats;
    MNUtil.showHUD(`æ˜¾ç¤º ${notes.length} ä¸ªç¬”è®°ï¼ˆæ€»è®¡ ${stats.total} ä¸ªï¼‰`);
  }
  
  // æ‰¹é‡è®¾ç½®ä¼˜å…ˆçº§
  batchSetPriority(priority) {
    let notes = this.filteredNotes;
    let count = 0;
    
    for (let note of notes) {
      note.priority = priority;
      note.modified = new Date();
      count++;
    }
    
    MNUtil.showHUD(`å·²ä¸º ${count} ä¸ªç¬”è®°è®¾ç½®ä¼˜å…ˆçº§ä¸º ${priority}`);
    return count;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let manager = new NoteManager();

// æ·»åŠ ä¸€äº›ç¬”è®°
manager.addNote("å­¦ä¹ JavaScriptç±»", "ä»Šå¤©å­¦ä¼šäº†ç±»çš„åŸºæœ¬æ¦‚å¿µ", 4);
manager.addNote("MarginNoteæŠ€å·§", "å­¦ä¼šäº†æ‰¹é‡å¤„ç†ç¬”è®°", 2);
manager.addNote("é¡¹ç›®è®¡åˆ’", "ä¸‹å‘¨è¦å®Œæˆçš„ä»»åŠ¡æ¸…å•", 5);
manager.addNote("è¯»ä¹¦ç¬”è®°", "ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹", 1);

// æŸ¥çœ‹æ‰€æœ‰ç¬”è®°
manager.displayNotes();

// åªçœ‹é«˜ä¼˜å…ˆçº§ç¬”è®°
manager.filter = "high";
manager.displayNotes();

// æ‰¹é‡è°ƒæ•´ä¼˜å…ˆçº§
manager.batchSetPriority(3);

// æœç´¢ç¬”è®°
let found = manager.findByTitle("JavaScript");
MNUtil.log("æ‰¾åˆ° " + found.length + " ä¸ªç›¸å…³ç¬”è®°");

// æŸ¥çœ‹ç»Ÿè®¡
let stats = manager.stats;
MNUtil.log(`ç»Ÿè®¡: é«˜${stats.high}ä¸ª, ä¸­${stats.medium}ä¸ª, ä½${stats.low}ä¸ª`);
```

---

### ç¬¬5ç« å°ç»“

ğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒæŠ€èƒ½ï¼š

âœ… **ç±»çš„åŸºç¡€**ï¼šåˆ›å»ºå¯é‡ç”¨çš„å¯¹è±¡æ¨¡æ¿
- `class ClassName { }` å®šä¹‰ç±»
- `constructor()` æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡
- `new ClassName()` åˆ›å»ºå®ä¾‹

âœ… **å®ä¾‹å±æ€§å’Œæ–¹æ³•**ï¼šå¯¹è±¡çš„æ•°æ®å’Œè¡Œä¸º
- `this.property` è®¿é—®å¯¹è±¡å±æ€§
- æ–¹æ³•ä¸­çš„ `this` æŒ‡å‘å½“å‰å¯¹è±¡
- å°è£…ç›¸å…³åŠŸèƒ½åˆ°ç±»ä¸­

âœ… **getter å’Œ setter**ï¼šè®©å±æ€§å˜å¾—æ™ºèƒ½
- `get propertyName()` æ§åˆ¶å±æ€§è¯»å–
- `set propertyName(value)` æ§åˆ¶å±æ€§è®¾ç½®
- æ•°æ®éªŒè¯å’Œè‡ªåŠ¨å¤„ç†

âœ… **å®é™…åº”ç”¨**ï¼šåœ¨ MarginNote æ’ä»¶ä¸­çš„åº”ç”¨
- åˆ›å»ºåŠŸèƒ½ç±»å°è£…å¤æ‚é€»è¾‘
- æ™ºèƒ½å±æ€§ç®¡ç†
- æ‰¹é‡å¤„ç†å’Œæ•°æ®ç»Ÿè®¡

ç°åœ¨ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„"æ™ºèƒ½å¯¹è±¡"äº†ï¼ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æƒ³åˆ›å»ºä¸€äº›ä¸éœ€è¦å®ä¾‹åŒ–å°±èƒ½ä½¿ç”¨çš„å·¥å…·æ–¹æ³•å‘¢ï¼Ÿæ¯”å¦‚ `MNUtil.showHUD()` è¿™æ ·çš„ï¼Ÿ

è®©æˆ‘ä»¬è¿›å…¥ç¬¬6ç« ï¼Œå­¦ä¹ **é™æ€æ–¹æ³•**å’Œå·¥å…·ç±»è®¾è®¡ï¼

### ç¬¬6ç« ï¼šé™æ€æ–¹æ³•å’Œå·¥å…·ç±»

> ğŸ¤” **é—®é¢˜**ï¼šä½ æ³¨æ„åˆ°äº†å—ï¼Ÿæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ `MNUtil.showHUD()`ã€`MNUtil.log()` è¿™æ ·çš„æ–¹æ³•ï¼Œä½†ä»æ¥æ²¡æœ‰å†™è¿‡ `new MNUtil()`ï¼Ÿè¿™å°±æ˜¯é™æ€æ–¹æ³•çš„é­…åŠ›ï¼

#### 6.1 static å…³é”®å­— - ç±»æ–¹æ³• vs å®ä¾‹æ–¹æ³•

**ç”Ÿæ´»ç±»æ¯”**ï¼šæƒ³è±¡ä¸€ä¸ªæ±½è½¦å·¥å‚
- **é™æ€æ–¹æ³•ï¼ˆstaticï¼‰**= å·¥å‚çš„åŠŸèƒ½ï¼ˆç»Ÿè®¡æ€»äº§é‡ã€åˆ¶å®šç”Ÿäº§è§„èŒƒï¼‰
- **å®ä¾‹æ–¹æ³•**= æ¯è¾†è½¦çš„åŠŸèƒ½ï¼ˆå¯åŠ¨ã€åˆ¹è½¦ã€åŠ é€Ÿï¼‰

```javascript
class Car {
  constructor(brand, model) {
    this.brand = brand;
    this.model = model;
    Car.totalCars++; // æ¯é€ ä¸€è¾†è½¦ï¼Œæ€»æ•°+1
  }
  
  // é™æ€å±æ€§ - å±äºæ•´ä¸ªç±»
  static totalCars = 0;
  
  // é™æ€æ–¹æ³• - ä¸éœ€è¦åˆ›å»ºå®ä¾‹å°±èƒ½ç”¨
  static getTotalCars() {
    return Car.totalCars;
  }
  
  static createStandardCar() {
    return new Car("ä¸°ç”°", "å¡ç½—æ‹‰");
  }
  
  // å®ä¾‹æ–¹æ³• - éœ€è¦åˆ›å»ºå®ä¾‹æ‰èƒ½ç”¨
  start() {
    MNUtil.showHUD(this.brand + " " + this.model + " å¯åŠ¨äº†");
  }
  
  getInfo() {
    return this.brand + " " + this.model;
  }
}

// é™æ€æ–¹æ³•çš„ä½¿ç”¨ - ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨
MNUtil.log("ç›®å‰ç”Ÿäº§äº† " + Car.getTotalCars() + " è¾†è½¦");  // 0
let standardCar = Car.createStandardCar();

// å®ä¾‹æ–¹æ³•çš„ä½¿ç”¨ - éœ€è¦å…ˆåˆ›å»ºå¯¹è±¡
let myCar = new Car("æœ¬ç”°", "é›…é˜");
myCar.start();  // æœ¬ç”° é›…é˜ å¯åŠ¨äº†

MNUtil.log("ç›®å‰ç”Ÿäº§äº† " + Car.getTotalCars() + " è¾†è½¦");  // 2
```

#### 6.2 MNUtil ç±»çš„è®¾è®¡æ€æƒ³

è®©æˆ‘ä»¬çœ‹çœ‹ MNUtil è¿™ä¸ªå…¸å‹å·¥å…·ç±»çš„è®¾è®¡ï¼š

```javascript
// MNUtil å°±æ˜¯ä¸€ä¸ªçº¯é™æ€æ–¹æ³•çš„å·¥å…·ç±»
class MNUtil {
  // é™æ€æ–¹æ³• - å·¥å…·å‡½æ•°ï¼Œä¸éœ€è¦å®ä¾‹
  static showHUD(message, duration = 2) {
    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
  }
  
  static copy(text) {
    // å¤åˆ¶åˆ°å‰ªè´´æ¿
  }
  
  static delay(seconds) {
    // å»¶è¿Ÿæ‰§è¡Œ
    return new Promise(resolve => setTimeout(resolve, seconds * 1000));
  }
  
  static log(message) {
    // è¾“å‡ºæ—¥å¿—
  }
  
  static getRandomColor() {
    return Math.floor(Math.random() * 6); // 0-5çš„éšæœºé¢œè‰²
  }
}

// ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ new MNUtil()
MNUtil.showHUD("ä¿å­˜æˆåŠŸ!");
MNUtil.copy("å¤åˆ¶çš„æ–‡æœ¬");
let color = MNUtil.getRandomColor();
```

**ä¸ºä»€ä¹ˆ MNUtil éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Ÿ**
- **æ— çŠ¶æ€**ï¼šè¿™äº›å·¥å…·å‡½æ•°ä¸éœ€è¦ä¿å­˜ä»»ä½•æ•°æ®
- **é€šç”¨æ€§**ï¼šä»»ä½•åœ°æ–¹éƒ½èƒ½ç›´æ¥è°ƒç”¨
- **ç®€å•æ€§**ï¼šä¸éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨

#### 6.3 åˆ›å»ºè‡ªå·±çš„å·¥å…·ç±»

è®©æˆ‘ä»¬ä¸º MarginNote æ’ä»¶åˆ›å»ºä¸€ä¸ªå®ç”¨å·¥å…·ç±»ï¼š

```javascript
class PluginUtils {
  // æ—¶é—´ç›¸å…³å·¥å…·
  static formatTimestamp(date = new Date()) {
    return date.toLocaleDateString('zh-CN') + ' ' + 
           date.toLocaleTimeString('zh-CN', {hour12: false});
  }
  
  static getDateString(format = 'YYYY-MM-DD') {
    let date = new Date();
    let year = date.getFullYear();
    let month = (date.getMonth() + 1).toString().padStart(2, '0');
    let day = date.getDate().toString().padStart(2, '0');
    
    switch(format) {
      case 'YYYY-MM-DD':
        return `${year}-${month}-${day}`;
      case 'MM/DD':
        return `${month}/${day}`;
      case 'Chinese':
        return `${year}å¹´${month}æœˆ${day}æ—¥`;
      default:
        return `${year}-${month}-${day}`;
    }
  }
  
  // æ–‡æœ¬å¤„ç†å·¥å…·
  static cleanText(text) {
    if (!text) return "";
    return text.trim().replace(/\s+/g, ' ').replace(/[^\w\s\u4e00-\u9fff]/g, '');
  }
  
  static truncateText(text, maxLength = 50) {
    if (!text || text.length <= maxLength) return text;
    return text.substring(0, maxLength) + "...";
  }
  
  // æ•°æ®éªŒè¯å·¥å…·
  static isValidNoteId(id) {
    return typeof id === 'string' && id.length === 36 && 
           /^[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12}$/.test(id);
  }
  
  static isValidColor(colorIndex) {
    return Number.isInteger(colorIndex) && colorIndex >= 0 && colorIndex <= 5;
  }
  
  // ç¬”è®°æ‰¹é‡æ“ä½œå·¥å…·
  static batchProcess(notes, processor, showProgress = true) {
    if (!Array.isArray(notes) || notes.length === 0) {
      MNUtil.showHUD("æ²¡æœ‰ç¬”è®°éœ€è¦å¤„ç†");
      return [];
    }
    
    let results = [];
    let processed = 0;
    
    for (let note of notes) {
      try {
        let result = processor(note);
        results.push({ note, result, success: true });
        processed++;
        
        if (showProgress && processed % 10 === 0) {
          MNUtil.showHUD(`å·²å¤„ç† ${processed}/${notes.length} ä¸ªç¬”è®°`);
        }
      } catch (error) {
        results.push({ note, error, success: false });
        MNUtil.log(`å¤„ç†ç¬”è®°å¤±è´¥: ${error.message}`);
      }
    }
    
    if (showProgress) {
      MNUtil.showHUD(`æ‰¹é‡å¤„ç†å®Œæˆ: æˆåŠŸ ${results.filter(r => r.success).length} ä¸ª`);
    }
    
    return results;
  }
  
  // é…ç½®ç®¡ç†å·¥å…·
  static saveConfig(key, value) {
    try {
      let config = JSON.stringify(value);
      // è¿™é‡Œåº”è¯¥ä½¿ç”¨å®é™…çš„å­˜å‚¨æœºåˆ¶
      MNUtil.log(`é…ç½®å·²ä¿å­˜: ${key} = ${config}`);
      return true;
    } catch (error) {
      MNUtil.showHUD("é…ç½®ä¿å­˜å¤±è´¥: " + error.message);
      return false;
    }
  }
  
  static loadConfig(key, defaultValue = null) {
    try {
      // è¿™é‡Œåº”è¯¥ä½¿ç”¨å®é™…çš„è¯»å–æœºåˆ¶
      MNUtil.log(`åŠ è½½é…ç½®: ${key}`);
      return defaultValue; // è¿”å›é»˜è®¤å€¼ä½œä¸ºç¤ºä¾‹
    } catch (error) {
      MNUtil.log("é…ç½®è¯»å–å¤±è´¥: " + error.message);
      return defaultValue;
    }
  }
  
  // ID ç”Ÿæˆå·¥å…·
  static generateId(prefix = 'item') {
    return prefix + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let timestamp = PluginUtils.formatTimestamp();
let dateStr = PluginUtils.getDateString('Chinese');
let cleanTitle = PluginUtils.cleanText("  é‡è¦ç¬”è®°!!! ");
let shortText = PluginUtils.truncateText("è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬å†…å®¹", 10);

MNUtil.log("æ—¶é—´æˆ³: " + timestamp);
MNUtil.log("æ—¥æœŸ: " + dateStr);
MNUtil.log("æ¸…ç†åæ ‡é¢˜: " + cleanTitle);
MNUtil.log("æˆªæ–­æ–‡æœ¬: " + shortText);

// æ‰¹é‡å¤„ç†ç¬”è®°
let notes = MNNote.getFocusNotes();
if (notes.length > 0) {
  PluginUtils.batchProcess(notes, (note) => {
    // ä¸ºæ¯ä¸ªç¬”è®°æ·»åŠ æ—¶é—´æˆ³
    note.appendTextComment("å¤„ç†æ—¶é—´: " + PluginUtils.formatTimestamp());
    return "å·²æ·»åŠ æ—¶é—´æˆ³";
  });
}

// ç”Ÿæˆå”¯ä¸€ID
let taskId = PluginUtils.generateId('task');
MNUtil.log("ç”Ÿæˆçš„ä»»åŠ¡ID: " + taskId);
```

#### 6.4 é™æ€æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯

**ä½•æ—¶ä½¿ç”¨ staticï¼Ÿ**

âœ… **é€‚åˆä½¿ç”¨é™æ€æ–¹æ³•**ï¼š
1. **å·¥å…·å‡½æ•°**ï¼šä¸éœ€è¦å¯¹è±¡çŠ¶æ€ï¼Œçº¯ç²¹çš„åŠŸèƒ½å‡½æ•°
2. **å·¥å‚æ–¹æ³•**ï¼šåˆ›å»ºç‰¹å®šç±»å‹çš„å®ä¾‹
3. **éªŒè¯å‡½æ•°**ï¼šæ•°æ®æ ¼å¼éªŒè¯
4. **é…ç½®ç®¡ç†**ï¼šå…¨å±€è®¾ç½®çš„è¯»å†™
5. **å¸¸é‡å®šä¹‰**ï¼šç±»ç›¸å…³çš„å¸¸é‡

âŒ **ä¸é€‚åˆä½¿ç”¨é™æ€æ–¹æ³•**ï¼š
1. **éœ€è¦è®¿é—®å®ä¾‹å±æ€§**ï¼šä¾èµ– `this` çš„æ“ä½œ
2. **æœ‰çŠ¶æ€çš„æ“ä½œ**ï¼šéœ€è¦è®°ä½ä¹‹å‰çš„æ“ä½œç»“æœ
3. **ä¸ªæ€§åŒ–è¡Œä¸º**ï¼šæ¯ä¸ªå¯¹è±¡è¡Œä¸ºä¸åŒçš„æ“ä½œ

```javascript
class NoteValidator {
  // âœ… é™æ€æ–¹æ³• - çº¯éªŒè¯åŠŸèƒ½
  static isValidTitle(title) {
    return title && title.trim().length > 0 && title.length <= 100;
  }
  
  static isValidColor(color) {
    return Number.isInteger(color) && color >= 0 && color <= 5;
  }
  
  // âœ… é™æ€å·¥å‚æ–¹æ³•
  static createDefaultNote() {
    return {
      title: "æ–°å»ºç¬”è®°",
      content: "",
      color: 0,
      created: new Date()
    };
  }
}

class NoteProcessor {
  constructor(pluginName) {
    this.pluginName = pluginName;
    this.processedCount = 0;  // å®ä¾‹çŠ¶æ€
  }
  
  // âŒ ä¸é€‚åˆé™æ€ - éœ€è¦è®¿é—®å®ä¾‹çŠ¶æ€
  processNote(note) {
    this.processedCount++;  // è®¿é—®äº†å®ä¾‹å±æ€§
    MNUtil.log(`${this.pluginName} å¤„ç†äº†ç¬¬ ${this.processedCount} ä¸ªç¬”è®°`);
  }
  
  // âœ… å¯ä»¥æ˜¯é™æ€ - çº¯åŠŸèƒ½å‡½æ•°
  static formatNoteTitle(title) {
    return title.trim().replace(/\s+/g, ' ');
  }
}
```

---

### ç¬¬6ç« å°ç»“

ğŸ‰ ä½ å·²ç»æŒæ¡äº†é™æ€æ–¹æ³•å’Œå·¥å…·ç±»çš„è®¾è®¡ï¼

âœ… **æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- `static` å…³é”®å­—åˆ›å»ºç±»çº§åˆ«çš„æ–¹æ³•å’Œå±æ€§
- é™æ€æ–¹æ³•ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨ï¼Œæ— éœ€åˆ›å»ºå®ä¾‹
- é™æ€æ–¹æ³•ä¸èƒ½è®¿é—®å®ä¾‹çš„ `this`

âœ… **è®¾è®¡åŸåˆ™**ï¼š
- å·¥å…·å‡½æ•° â†’ é™æ€æ–¹æ³•
- æ— çŠ¶æ€æ“ä½œ â†’ é™æ€æ–¹æ³•
- éœ€è¦å®ä¾‹æ•°æ® â†’ å®ä¾‹æ–¹æ³•

âœ… **å®é™…åº”ç”¨**ï¼š
- `MNUtil` ç­‰å·¥å…·ç±»çš„è®¾è®¡ç†å¿µ
- åˆ›å»ºè‡ªå·±çš„æ’ä»¶å·¥å…·ç±»
- åˆç†é€‰æ‹©é™æ€æ–¹æ³• vs å®ä¾‹æ–¹æ³•

ç°åœ¨ä½ å¯ä»¥è®¾è®¡å‡ºç»“æ„æ¸…æ™°çš„å·¥å…·ç±»äº†ï¼ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æƒ³åŸºäºç°æœ‰çš„ç±»åˆ›å»ºæ–°çš„ã€æ›´ä¸“é—¨åŒ–çš„ç±»å‘¢ï¼Ÿæ¯”å¦‚åˆ›å»ºä¸€ä¸ª"é«˜çº§ç¬”è®°å¤„ç†å™¨"ç»§æ‰¿åŸºç¡€çš„"ç¬”è®°å¤„ç†å™¨"ï¼Ÿ

è®©æˆ‘ä»¬è¿›å…¥ç¬¬7ç« ï¼Œå­¦ä¹ **ç»§æ‰¿**çš„æ¦‚å¿µï¼

### ç¬¬7ç« ï¼šç»§æ‰¿å’Œæ‰©å±• - åœ¨å·²æœ‰åŸºç¡€ä¸Šæ„å»º

> ğŸ¤” **é—®é¢˜**ï¼šå¦‚æœæˆ‘æœ‰ä¸€ä¸ªåŸºç¡€çš„"ç¬”è®°å¤„ç†å™¨"ï¼Œç°åœ¨æƒ³åˆ›å»ºä¸€ä¸ªåŠŸèƒ½æ›´å¼ºå¤§çš„"é«˜çº§ç¬”è®°å¤„ç†å™¨"ï¼Œéš¾é“è¦é‡å†™æ‰€æœ‰ä»£ç å—ï¼Ÿ

#### 7.1 ç»§æ‰¿åŸºç¡€ - extends å…³é”®å­—

**ç”Ÿæ´»ç±»æ¯”**ï¼šç»§æ‰¿å°±åƒ"é’å‡ºäºè“è€Œèƒœäºè“"
- **çˆ¶ç±»**ï¼ˆåŸºç±»ï¼‰= å¸ˆçˆ¶çš„åŸºæœ¬æŠ€èƒ½
- **å­ç±»**ï¼ˆæ´¾ç”Ÿç±»ï¼‰= å¾’å¼Ÿåœ¨å¸ˆçˆ¶åŸºç¡€ä¸Šå‘å±•å‡ºçš„æ–°æŠ€èƒ½
- **æ–¹æ³•ç»§æ‰¿**= å¾’å¼Ÿå­¦ä¼šäº†å¸ˆçˆ¶çš„æ‰€æœ‰æŠ€èƒ½
- **æ–¹æ³•é‡å†™**= å¾’å¼Ÿå¯¹æŸäº›æŠ€èƒ½æœ‰äº†è‡ªå·±çš„æ”¹è¿›

```javascript
// åŸºç¡€ç¬”è®°å¤„ç†å™¨ï¼ˆçˆ¶ç±»ï¼‰
class NoteProcessor {
  constructor(name) {
    this.name = name;
    this.processedCount = 0;
  }
  
  // åŸºç¡€å¤„ç†æ–¹æ³•
  processNote(note) {
    if (!note) {
      MNUtil.showHUD("æ²¡æœ‰ç¬”è®°éœ€è¦å¤„ç†");
      return false;
    }
    
    // åŸºç¡€å¤„ç†ï¼šæ¸…ç†æ ‡é¢˜
    if (note.noteTitle) {
      note.noteTitle = note.noteTitle.trim();
    }
    
    this.processedCount++;
    MNUtil.log(`${this.name} å¤„ç†äº†ç¬¬ ${this.processedCount} ä¸ªç¬”è®°`);
    return true;
  }
  
  // è·å–ç»Ÿè®¡ä¿¡æ¯
  getStats() {
    return {
      processor: this.name,
      processed: this.processedCount
    };
  }
  
  // é‡ç½®è®¡æ•°
  reset() {
    this.processedCount = 0;
    MNUtil.log(`${this.name} å·²é‡ç½®`);
  }
}

// é«˜çº§ç¬”è®°å¤„ç†å™¨ï¼ˆå­ç±»ï¼‰- ç»§æ‰¿è‡ª NoteProcessor
class AdvancedNoteProcessor extends NoteProcessor {
  constructor(name, options = {}) {
    super(name);  // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.autoColor = options.autoColor || false;
    this.addTimestamp = options.addTimestamp || false;
    this.errorCount = 0;
  }
  
  // é‡å†™çˆ¶ç±»æ–¹æ³• - æ·»åŠ æ›´å¤šåŠŸèƒ½
  processNote(note) {
    // å…ˆè°ƒç”¨çˆ¶ç±»çš„åŸºç¡€å¤„ç†
    let success = super.processNote(note);
    
    if (!success) {
      this.errorCount++;
      return false;
    }
    
    // æ·»åŠ é«˜çº§åŠŸèƒ½
    if (this.autoColor && note.noteTitle) {
      // æ ¹æ®æ ‡é¢˜å†…å®¹è‡ªåŠ¨è®¾ç½®é¢œè‰²
      if (note.noteTitle.includes("é‡è¦") || note.noteTitle.includes("!!!")) {
        note.colorIndex = 1; // çº¢è‰²
      } else if (note.noteTitle.includes("TODO") || note.noteTitle.includes("å¾…åŠ")) {
        note.colorIndex = 3; // é»„è‰²
      }
    }
    
    if (this.addTimestamp) {
      // æ·»åŠ æ—¶é—´æˆ³è¯„è®º
      let timestamp = new Date().toLocaleString('zh-CN');
      note.appendTextComment(`å¤„ç†æ—¶é—´: ${timestamp}`);
    }
    
    MNUtil.log(`é«˜çº§å¤„ç†å™¨é¢å¤–å¤„ç†äº†ç¬”è®°: ${note.noteTitle}`);
    return true;
  }
  
  // æ–°å¢æ–¹æ³• - çˆ¶ç±»æ²¡æœ‰çš„åŠŸèƒ½
  batchColorByKeyword(notes, keyword, color) {
    let count = 0;
    for (let note of notes) {
      if (note.noteTitle && note.noteTitle.includes(keyword)) {
        note.colorIndex = color;
        count++;
      }
    }
    MNUtil.showHUD(`ä¸º ${count} ä¸ªåŒ…å«"${keyword}"çš„ç¬”è®°è®¾ç½®äº†é¢œè‰²`);
    return count;
  }
  
  // é‡å†™çˆ¶ç±»çš„ç»Ÿè®¡æ–¹æ³• - æ·»åŠ é”™è¯¯ç»Ÿè®¡
  getStats() {
    let baseStats = super.getStats(); // è·å–çˆ¶ç±»çš„ç»Ÿè®¡
    return {
      ...baseStats,  // å±•å¼€çˆ¶ç±»ç»Ÿè®¡
      errors: this.errorCount,
      successRate: this.processedCount > 0 ? 
        ((this.processedCount - this.errorCount) / this.processedCount * 100).toFixed(1) + '%' : 'N/A'
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let basicProcessor = new NoteProcessor("åŸºç¡€å¤„ç†å™¨");
let advancedProcessor = new AdvancedNoteProcessor("é«˜çº§å¤„ç†å™¨", {
  autoColor: true,
  addTimestamp: true
});

// æµ‹è¯•åŸºç¡€å¤„ç†å™¨
let notes = MNNote.getFocusNotes();
if (notes.length > 0) {
  basicProcessor.processNote(notes[0]);
  MNUtil.log(basicProcessor.getStats());
  
  // æµ‹è¯•é«˜çº§å¤„ç†å™¨
  advancedProcessor.processNote(notes[0]);
  MNUtil.log(advancedProcessor.getStats());
  
  // ä½¿ç”¨é«˜çº§å¤„ç†å™¨çš„ç‰¹æœ‰åŠŸèƒ½
  advancedProcessor.batchColorByKeyword(notes, "é‡è¦", 1);
}
```

#### 7.2 super å…³é”®å­— - ä¸çˆ¶ç±»çš„æ­£ç¡®æ²Ÿé€šæ–¹å¼

> ğŸ¤” **é—®é¢˜**ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨äº† `super.processNote()` å’Œ `super.getStats()`ï¼Œè¿™ä¸ª `super` æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

**super å°±åƒæ˜¯"è¯·æ•™å¸ˆçˆ¶"**ï¼š
- `super()` = è¯·æ•™å¸ˆçˆ¶å¦‚ä½•åˆå§‹åŒ–
- `super.methodName()` = è¯·æ•™å¸ˆçˆ¶å¦‚ä½•åšæŸä»¶äº‹
- `super` è®©å­ç±»èƒ½å¤Ÿå¤ç”¨çˆ¶ç±»çš„ä»£ç ï¼Œè€Œä¸æ˜¯é‡å†™ä¸€é

```javascript
class Plugin {
  constructor(name, version) {
    this.name = name;
    this.version = version;
    this.isActive = false;
    MNUtil.log(`æ’ä»¶ ${name} v${version} å·²åˆ›å»º`);
  }
  
  activate() {
    this.isActive = true;
    MNUtil.showHUD(`${this.name} å·²æ¿€æ´»`);
  }
  
  deactivate() {
    this.isActive = false;
    MNUtil.showHUD(`${this.name} å·²åœç”¨`);
  }
  
  getInfo() {
    return `${this.name} v${this.version} (${this.isActive ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»'})`;
  }
}

class MarginNotePlugin extends Plugin {
  constructor(name, version, mnVersion) {
    // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    super(name, version);
    this.mnVersion = mnVersion;
    this.features = [];
    MNUtil.log(`MarginNote æ’ä»¶åˆå§‹åŒ–å®Œæˆï¼Œæ”¯æŒ MN ${mnVersion}`);
  }
  
  // é‡å†™æ¿€æ´»æ–¹æ³•ï¼Œæ·»åŠ æ’ä»¶ç‰¹æœ‰é€»è¾‘
  activate() {
    // å…ˆæ‰§è¡Œçˆ¶ç±»çš„æ¿€æ´»é€»è¾‘
    super.activate();
    
    // å†æ·»åŠ  MarginNote æ’ä»¶ç‰¹æœ‰çš„æ¿€æ´»é€»è¾‘
    this.loadFeatures();
    this.setupUI();
    MNUtil.log(`${this.name} çš„æ‰€æœ‰åŠŸèƒ½å·²åŠ è½½`);
  }
  
  // æ–°å¢æ–¹æ³•
  addFeature(featureName) {
    this.features.push(featureName);
    MNUtil.log(`æ·»åŠ åŠŸèƒ½: ${featureName}`);
  }
  
  loadFeatures() {
    // æ¨¡æ‹ŸåŠ è½½åŠŸèƒ½
    this.addFeature("ç¬”è®°å¯¼å‡º");
    this.addFeature("æ‰¹é‡å¤„ç†");
    this.addFeature("å¿«æ·æ“ä½œ");
  }
  
  setupUI() {
    MNUtil.log("è®¾ç½®ç”¨æˆ·ç•Œé¢...");
  }
  
  // é‡å†™ getInfo æ–¹æ³•ï¼Œæ·»åŠ æ›´å¤šä¿¡æ¯
  getInfo() {
    let baseInfo = super.getInfo(); // è·å–çˆ¶ç±»çš„åŸºæœ¬ä¿¡æ¯
    return `${baseInfo}\næ”¯æŒ MarginNote ${this.mnVersion}\nåŠŸèƒ½æ•°é‡: ${this.features.length}`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let myPlugin = new MarginNotePlugin("è¶…çº§ç¬”è®°åŠ©æ‰‹", "2.1.0", "4.0");
myPlugin.activate();
MNUtil.log(myPlugin.getInfo());
```

#### 7.3 åœ¨ MarginNote æ’ä»¶ä¸­çš„ç»§æ‰¿åº”ç”¨

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šåˆ›å»ºä¸åŒç±»å‹çš„ç¬”è®°åˆ†æå™¨

```javascript
// åŸºç¡€åˆ†æå™¨
class NoteAnalyzer {
  constructor(name) {
    this.name = name;
    this.results = {};
  }
  
  analyze(notes) {
    if (!Array.isArray(notes) || notes.length === 0) {
      MNUtil.showHUD("æ²¡æœ‰ç¬”è®°éœ€è¦åˆ†æ");
      return null;
    }
    
    this.results = {
      total: notes.length,
      analyzed: 0,
      timestamp: new Date().toLocaleString()
    };
    
    for (let note of notes) {
      if (this.analyzeNote(note)) {
        this.results.analyzed++;
      }
    }
    
    MNUtil.log(`${this.name} åˆ†æå®Œæˆ: ${this.results.analyzed}/${this.results.total}`);
    return this.results;
  }
  
  // åŸºç¡€åˆ†ææ–¹æ³•ï¼ˆå­ç±»å¯ä»¥é‡å†™ï¼‰
  analyzeNote(note) {
    // åŸºç¡€åˆ†æï¼šæ£€æŸ¥ç¬”è®°æ˜¯å¦æœ‰æ ‡é¢˜
    return note.noteTitle && note.noteTitle.trim().length > 0;
  }
  
  getReport() {
    return `${this.name} åˆ†ææŠ¥å‘Š:\næ€»è®¡: ${this.results.total || 0}\nå·²åˆ†æ: ${this.results.analyzed || 0}`;
  }
}

// å†…å®¹åˆ†æå™¨ - åˆ†æç¬”è®°å†…å®¹
class ContentAnalyzer extends NoteAnalyzer {
  constructor() {
    super("å†…å®¹åˆ†æå™¨");
  }
  
  analyzeNote(note) {
    // å…ˆæ‰§è¡Œçˆ¶ç±»çš„åŸºç¡€æ£€æŸ¥
    if (!super.analyzeNote(note)) {
      return false;
    }
    
    // å†…å®¹ç‰¹å®šåˆ†æ
    let hasContent = note.textContent && note.textContent.trim().length > 0;
    let hasComments = note.comments && note.comments.length > 0;
    
    // è®°å½•æ›´è¯¦ç»†çš„ä¿¡æ¯
    if (!this.results.details) {
      this.results.details = {
        withContent: 0,
        withComments: 0,
        empty: 0
      };
    }
    
    if (hasContent) this.results.details.withContent++;
    if (hasComments) this.results.details.withComments++;
    if (!hasContent && !hasComments) this.results.details.empty++;
    
    return hasContent || hasComments;
  }
  
  getReport() {
    let baseReport = super.getReport();
    if (this.results.details) {
      baseReport += `\næœ‰å†…å®¹: ${this.results.details.withContent}`;
      baseReport += `\næœ‰è¯„è®º: ${this.results.details.withComments}`;
      baseReport += `\nç©ºç¬”è®°: ${this.results.details.empty}`;
    }
    return baseReport;
  }
}

// å…³é”®è¯åˆ†æå™¨ - åˆ†æå…³é”®è¯åˆ†å¸ƒ
class KeywordAnalyzer extends NoteAnalyzer {
  constructor(keywords = []) {
    super("å…³é”®è¯åˆ†æå™¨");
    this.keywords = keywords;
  }
  
  analyzeNote(note) {
    if (!super.analyzeNote(note)) {
      return false;
    }
    
    if (!this.results.keywords) {
      this.results.keywords = {};
      this.keywords.forEach(keyword => {
        this.results.keywords[keyword] = 0;
      });
    }
    
    let text = (note.noteTitle + ' ' + (note.textContent || '')).toLowerCase();
    
    for (let keyword of this.keywords) {
      if (text.includes(keyword.toLowerCase())) {
        this.results.keywords[keyword]++;
      }
    }
    
    return true;
  }
  
  getReport() {
    let baseReport = super.getReport();
    if (this.results.keywords) {
      baseReport += '\nå…³é”®è¯ç»Ÿè®¡:';
      for (let [keyword, count] of Object.entries(this.results.keywords)) {
        baseReport += `\n  ${keyword}: ${count}`;
      }
    }
    return baseReport;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let notes = MNNote.getFocusNotes();

if (notes.length > 0) {
  // åŸºç¡€åˆ†æ
  let basicAnalyzer = new NoteAnalyzer("åŸºç¡€åˆ†æå™¨");
  basicAnalyzer.analyze(notes);
  MNUtil.log(basicAnalyzer.getReport());
  
  // å†…å®¹åˆ†æ
  let contentAnalyzer = new ContentAnalyzer();
  contentAnalyzer.analyze(notes);
  MNUtil.log(contentAnalyzer.getReport());
  
  // å…³é”®è¯åˆ†æ
  let keywordAnalyzer = new KeywordAnalyzer(["é‡è¦", "TODO", "é—®é¢˜", "æ€»ç»“"]);
  keywordAnalyzer.analyze(notes);
  MNUtil.log(keywordAnalyzer.getReport());
}
```

---

### ç¬¬7ç« å°ç»“

ğŸ‰ ä½ å·²ç»æŒæ¡äº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„é«˜çº§ç‰¹æ€§ï¼

âœ… **ç»§æ‰¿çš„æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- `extends` å…³é”®å­—åˆ›å»ºå­ç±»
- å­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•
- å­ç±»å¯ä»¥æ·»åŠ æ–°åŠŸèƒ½å’Œé‡å†™ç°æœ‰åŠŸèƒ½

âœ… **super å…³é”®å­—çš„ç”¨æ³•**ï¼š
- `super()` è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
- `super.method()` è°ƒç”¨çˆ¶ç±»æ–¹æ³•
- å®ç°ä»£ç å¤ç”¨è€Œä¸æ˜¯é‡å¤ç¼–å†™

âœ… **å®é™…åº”ç”¨åœºæ™¯**ï¼š
- åˆ›å»ºä¸“é—¨åŒ–çš„å¤„ç†å™¨ç±»
- æ’ä»¶ç³»ç»Ÿçš„æ‰©å±•æ¶æ„
- åˆ†æå™¨ã€éªŒè¯å™¨ç­‰å·¥å…·ç±»çš„å±‚æ¬¡è®¾è®¡

âœ… **è®¾è®¡åŸåˆ™**ï¼š
- åŸºç±»å®šä¹‰é€šç”¨åŠŸèƒ½
- å­ç±»æ‰©å±•ç‰¹å®šåŠŸèƒ½
- ä½¿ç”¨ super å¤ç”¨çˆ¶ç±»ä»£ç 

ç°åœ¨ä½ å¯ä»¥è®¾è®¡å‡ºå…·æœ‰å±‚æ¬¡ç»“æ„çš„ç±»ç³»ç»Ÿäº†ï¼ä½ å·²ç»æŒæ¡äº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å­¦ä¹  JavaScript çš„æœ€åä¸€ä¸ªé‡è¦æ¦‚å¿µâ€”â€”**å¼‚æ­¥ç¼–ç¨‹**ï¼Œè¿™åœ¨ç°ä»£ Web å¼€å‘ä¸­éå¸¸é‡è¦ï¼

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¼‚æ­¥ç¼–ç¨‹

ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº† JavaScript çš„åŸºç¡€è¯­æ³•å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæœ€åè®©æˆ‘ä»¬å­¦ä¹ å¼‚æ­¥ç¼–ç¨‹â€”â€”è¿™æ˜¯ç°ä»£ç¼–ç¨‹ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µã€‚

### ç¬¬8ç« ï¼šå¼‚æ­¥ç¼–ç¨‹åŸºç¡€ - è®©ç¨‹åºæ›´é«˜æ•ˆ

> ğŸ¤” **é—®é¢˜**ï¼šæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç­‰å¾…æŸäº›æ“ä½œå®Œæˆï¼ˆæ¯”å¦‚å»¶æ—¶ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰ï¼Œä½†åˆä¸æƒ³è®©æ•´ä¸ªç¨‹åºå¡ä½ã€‚è¿™å°±éœ€è¦å¼‚æ­¥ç¼–ç¨‹ï¼

#### 8.1 åŒæ­¥ vs å¼‚æ­¥ - ç†è§£åŸºæœ¬æ¦‚å¿µ

**ç”Ÿæ´»ç±»æ¯”**ï¼š
- **åŒæ­¥**ï¼šåœ¨é“¶è¡Œæ’é˜Ÿï¼Œå¿…é¡»ç­‰å‰é¢çš„äººåŠå®Œæ‰è½®åˆ°ä½ ï¼ˆé˜»å¡ï¼‰
- **å¼‚æ­¥**ï¼šåœ¨é¤å…ç‚¹é¤ï¼Œç‚¹å®Œèœå¯ä»¥èŠå¤©ï¼Œèœå¥½äº†æœåŠ¡å‘˜ä¼šé€šçŸ¥ä½ ï¼ˆéé˜»å¡ï¼‰

```javascript
// åŒæ­¥ä»£ç  - æŒ‰é¡ºåºæ‰§è¡Œ
MNUtil.log("ç¬¬1æ­¥ï¼šå¼€å§‹å¤„ç†");
MNUtil.log("ç¬¬2æ­¥ï¼šå¤„ç†ä¸­..."); 
MNUtil.log("ç¬¬3æ­¥ï¼šå¤„ç†å®Œæˆ");
// æ‰§è¡Œé¡ºåºï¼š1 â†’ 2 â†’ 3

// å¼‚æ­¥ä»£ç  - ä¸ç­‰å¾…å°±ç»§ç»­æ‰§è¡Œ
MNUtil.log("ç¬¬1æ­¥ï¼šå¼€å§‹å¤„ç†");
setTimeout(() => {
  MNUtil.log("ç¬¬2æ­¥ï¼šå»¶æ—¶ä»»åŠ¡å®Œæˆ");  // 1ç§’åæ‰§è¡Œ
}, 1000);
MNUtil.log("ç¬¬3æ­¥ï¼šç»§ç»­å…¶ä»–ä»»åŠ¡");
// å®é™…æ‰§è¡Œé¡ºåºï¼š1 â†’ 3 â†’ (1ç§’å) 2
```

#### 8.2 Promise åŸºç¡€ - å¼‚æ­¥ç¼–ç¨‹çš„ç°ä»£æ–¹æ¡ˆ

**Promise å°±åƒ"æ‰¿è¯ºä¹¦"**ï¼š
- ç°åœ¨å…ˆç»™ä½ ä¸€ä¸ªæ‰¿è¯º
- å°†æ¥æŸä¸ªæ—¶å€™ä¼šå…‘ç°æ‰¿è¯ºï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰

```javascript
// åˆ›å»ºä¸€ä¸ªç®€å•çš„ Promise
function delayedTask(seconds) {
  return new Promise((resolve, reject) => {
    if (seconds < 0) {
      reject(new Error("æ—¶é—´ä¸èƒ½ä¸ºè´Ÿæ•°"));
      return;
    }
    
    setTimeout(() => {
      resolve(`ä»»åŠ¡åœ¨ ${seconds} ç§’åå®Œæˆäº†ï¼`);
    }, seconds * 1000);
  });
}

// ä½¿ç”¨ Promise
delayedTask(2)
  .then(result => {
    MNUtil.showHUD(result);  // 2ç§’åæ˜¾ç¤ºï¼šä»»åŠ¡åœ¨ 2 ç§’åå®Œæˆäº†ï¼
  })
  .catch(error => {
    MNUtil.showHUD("å‡ºé”™äº†: " + error.message);
  });

MNUtil.log("ä¸éœ€è¦ç­‰å¾…ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡");
```

#### 8.3 async/await - è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥

**async/await è®©å¼‚æ­¥ä»£ç æ›´ä¼˜é›…**ï¼š

```javascript
// ä¼ ç»Ÿ Promise å†™æ³•ï¼ˆå›è°ƒåœ°ç‹±ï¼‰
function processNotesOldWay() {
  delayedTask(1)
    .then(result1 => {
      MNUtil.log(result1);
      return delayedTask(1);
    })
    .then(result2 => {
      MNUtil.log(result2);
      return delayedTask(1);
    })
    .then(result3 => {
      MNUtil.log(result3);
      MNUtil.showHUD("æ‰€æœ‰ä»»åŠ¡å®Œæˆ");
    })
    .catch(error => {
      MNUtil.showHUD("å‡ºé”™: " + error.message);
    });
}

// async/await å†™æ³•ï¼ˆæ¸…æ™°æ˜“è¯»ï¼‰
async function processNotesNewWay() {
  try {
    let result1 = await delayedTask(1);
    MNUtil.log(result1);
    
    let result2 = await delayedTask(1);  
    MNUtil.log(result2);
    
    let result3 = await delayedTask(1);
    MNUtil.log(result3);
    
    MNUtil.showHUD("æ‰€æœ‰ä»»åŠ¡å®Œæˆ");
  } catch (error) {
    MNUtil.showHUD("å‡ºé”™: " + error.message);
  }
}

// ä½¿ç”¨ async å‡½æ•°
processNotesNewWay();
```

#### 8.4 åœ¨ MarginNote æ’ä»¶ä¸­çš„å¼‚æ­¥åº”ç”¨

è®©æˆ‘ä»¬çœ‹çœ‹å®é™…çš„åº”ç”¨åœºæ™¯ï¼š

```javascript
class AsyncNoteProcessor {
  constructor(name) {
    this.name = name;
  }
  
  // æ¨¡æ‹Ÿè€—æ—¶çš„ç¬”è®°å¤„ç†
  async processNoteAsync(note) {
    if (!note) {
      throw new Error("æ²¡æœ‰ç¬”è®°éœ€è¦å¤„ç†");
    }
    
    MNUtil.log(`å¼€å§‹å¤„ç†ç¬”è®°: ${note.noteTitle}`);
    
    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€å¤æ‚è®¡ç®—ç­‰ï¼‰
    await this.delay(500); // ç­‰å¾…0.5ç§’
    
    // å¤„ç†ç¬”è®°
    if (note.noteTitle) {
      note.noteTitle = note.noteTitle.trim();
    }
    
    // å†æ¬¡æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    await this.delay(300);
    
    // æ·»åŠ æ—¶é—´æˆ³
    let timestamp = new Date().toLocaleString();
    note.appendTextComment(`å¤„ç†æ—¶é—´: ${timestamp}`);
    
    MNUtil.log(`å®Œæˆå¤„ç†ç¬”è®°: ${note.noteTitle}`);
    return `ç¬”è®° ${note.noteTitle} å¤„ç†å®Œæˆ`;
  }
  
  // å·¥å…·æ–¹æ³•ï¼šåˆ›å»ºå»¶æ—¶ Promise
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  
  // æ‰¹é‡å¼‚æ­¥å¤„ç†ç¬”è®°
  async batchProcessAsync(notes) {
    if (!notes || notes.length === 0) {
      MNUtil.showHUD("æ²¡æœ‰ç¬”è®°éœ€è¦å¤„ç†");
      return [];
    }
    
    MNUtil.showHUD(`å¼€å§‹æ‰¹é‡å¤„ç† ${notes.length} ä¸ªç¬”è®°`);
    let results = [];
    let errors = [];
    
    // æ–¹æ³•1ï¼šé¡ºåºå¤„ç†ï¼ˆä¸€ä¸ªæ¥ä¸€ä¸ªï¼‰
    for (let i = 0; i < notes.length; i++) {
      try {
        let result = await this.processNoteAsync(notes[i]);
        results.push(result);
        
        // æ˜¾ç¤ºè¿›åº¦
        if ((i + 1) % 5 === 0 || i === notes.length - 1) {
          MNUtil.showHUD(`å·²å¤„ç† ${i + 1}/${notes.length} ä¸ªç¬”è®°`);
        }
      } catch (error) {
        errors.push(`ç¬¬${i+1}ä¸ªç¬”è®°å¤„ç†å¤±è´¥: ${error.message}`);
        MNUtil.log(errors[errors.length - 1]);
      }
    }
    
    // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
    let summary = `æ‰¹é‡å¤„ç†å®Œæˆ:\næˆåŠŸ: ${results.length}\nå¤±è´¥: ${errors.length}`;
    MNUtil.showHUD(summary);
    
    return { results, errors };
  }
  
  // å¹¶è¡Œæ‰¹é‡å¤„ç†ï¼ˆåŒæ—¶å¤„ç†å¤šä¸ªï¼‰
  async batchProcessParallel(notes, maxConcurrent = 3) {
    if (!notes || notes.length === 0) {
      MNUtil.showHUD("æ²¡æœ‰ç¬”è®°éœ€è¦å¤„ç†");
      return [];
    }
    
    MNUtil.showHUD(`å¼€å§‹å¹¶è¡Œå¤„ç† ${notes.length} ä¸ªç¬”è®°`);
    let results = [];
    let errors = [];
    
    // åˆ†æ‰¹å¹¶è¡Œå¤„ç†
    for (let i = 0; i < notes.length; i += maxConcurrent) {
      let batch = notes.slice(i, i + maxConcurrent);
      let batchPromises = batch.map(async (note, index) => {
        try {
          let result = await this.processNoteAsync(note);
          return { success: true, result, index: i + index };
        } catch (error) {
          return { success: false, error: error.message, index: i + index };
        }
      });
      
      // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
      let batchResults = await Promise.all(batchPromises);
      
      // å¤„ç†æ‰¹æ¬¡ç»“æœ
      batchResults.forEach(item => {
        if (item.success) {
          results.push(item.result);
        } else {
          errors.push(`ç¬¬${item.index + 1}ä¸ªç¬”è®°: ${item.error}`);
        }
      });
      
      // æ˜¾ç¤ºè¿›åº¦
      let processed = Math.min(i + maxConcurrent, notes.length);
      MNUtil.showHUD(`å¹¶è¡Œå¤„ç†è¿›åº¦: ${processed}/${notes.length}`);
      
      // æ‰¹æ¬¡é—´ç¨ä½œå»¶è¿Ÿï¼Œé¿å…è¿‡åº¦å¹¶å‘
      if (i + maxConcurrent < notes.length) {
        await this.delay(100);
      }
    }
    
    let summary = `å¹¶è¡Œå¤„ç†å®Œæˆ:\næˆåŠŸ: ${results.length}\nå¤±è´¥: ${errors.length}`;
    MNUtil.showHUD(summary);
    
    return { results, errors };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function demonstrateAsyncProcessing() {
  let processor = new AsyncNoteProcessor("å¼‚æ­¥å¤„ç†å™¨");
  let notes = MNNote.getFocusNotes();
  
  if (notes.length > 0) {
    try {
      MNUtil.log("=== æ¼”ç¤ºå•ä¸ªç¬”è®°å¼‚æ­¥å¤„ç† ===");
      let result = await processor.processNoteAsync(notes[0]);
      MNUtil.log(result);
      
      if (notes.length > 1) {
        MNUtil.log("=== æ¼”ç¤ºæ‰¹é‡é¡ºåºå¤„ç† ===");
        let batchResult = await processor.batchProcessAsync(notes.slice(0, 3));
        MNUtil.log(`é¡ºåºå¤„ç†ç»“æœ: æˆåŠŸ${batchResult.results.length}ä¸ª`);
        
        MNUtil.log("=== æ¼”ç¤ºæ‰¹é‡å¹¶è¡Œå¤„ç† ===");
        let parallelResult = await processor.batchProcessParallel(notes.slice(0, 5));
        MNUtil.log(`å¹¶è¡Œå¤„ç†ç»“æœ: æˆåŠŸ${parallelResult.results.length}ä¸ª`);
      }
    } catch (error) {
      MNUtil.showHUD("å¤„ç†è¿‡ç¨‹ä¸­å‡ºé”™: " + error.message);
    }
  } else {
    MNUtil.showHUD("è¯·å…ˆé€‰æ‹©ä¸€äº›ç¬”è®°");
  }
}

// è°ƒç”¨æ¼”ç¤ºå‡½æ•°
demonstrateAsyncProcessing();
```

#### 8.5 å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µ

```javascript
class AsyncBestPractices {
  // 1. é”™è¯¯å¤„ç†è¦å®Œå–„
  static async safeAsyncOperation(operation) {
    try {
      let result = await operation();
      return { success: true, data: result };
    } catch (error) {
      MNUtil.log(`å¼‚æ­¥æ“ä½œå¤±è´¥: ${error.message}`);
      return { success: false, error: error.message };
    }
  }
  
  // 2. è®¾ç½®è¶…æ—¶é¿å…æ— é™ç­‰å¾…
  static async withTimeout(promise, timeoutMs = 5000) {
    let timeoutPromise = new Promise((_, reject) => {
      setTimeout(() => reject(new Error('æ“ä½œè¶…æ—¶')), timeoutMs);
    });
    
    return Promise.race([promise, timeoutPromise]);
  }
  
  // 3. æ‰¹é‡æ“ä½œè¦æ§åˆ¶å¹¶å‘æ•°
  static async batchWithLimit(items, asyncFn, limit = 3) {
    let results = [];
    
    for (let i = 0; i < items.length; i += limit) {
      let batch = items.slice(i, i + limit);
      let batchPromises = batch.map(item => asyncFn(item));
      let batchResults = await Promise.allSettled(batchPromises);
      
      results.push(...batchResults);
      
      // æ‰¹æ¬¡é—´ç¨ä½œå»¶è¿Ÿ
      if (i + limit < items.length) {
        await new Promise(resolve => setTimeout(resolve, 100));
      }
    }
    
    return results;
  }
  
  // 4. é‡è¯•æœºåˆ¶
  static async withRetry(asyncFn, maxRetries = 3, delay = 1000) {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await asyncFn();
      } catch (error) {
        if (attempt === maxRetries) {
          throw error;
        }
        
        MNUtil.log(`ç¬¬${attempt}æ¬¡å°è¯•å¤±è´¥ï¼Œ${delay}msåé‡è¯•...`);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }
}

// ä½¿ç”¨æœ€ä½³å®è·µçš„ç¤ºä¾‹
async function bestPracticeExample() {
  // 1. å®‰å…¨çš„å¼‚æ­¥æ“ä½œ
  let safeResult = await AsyncBestPractices.safeAsyncOperation(async () => {
    // æ¨¡æ‹Ÿå¯èƒ½å‡ºé”™çš„æ“ä½œ
    if (Math.random() > 0.5) {
      throw new Error("éšæœºé”™è¯¯");
    }
    return "æ“ä½œæˆåŠŸ";
  });
  
  if (safeResult.success) {
    MNUtil.log("å®‰å…¨æ“ä½œæˆåŠŸ: " + safeResult.data);
  } else {
    MNUtil.log("å®‰å…¨æ“ä½œå¤±è´¥: " + safeResult.error);
  }
  
  // 2. å¸¦è¶…æ—¶çš„æ“ä½œ
  try {
    let timeoutResult = await AsyncBestPractices.withTimeout(
      delayedTask(3),  // 3ç§’çš„ä»»åŠ¡
      2000            // 2ç§’è¶…æ—¶
    );
    MNUtil.log("è¶…æ—¶æµ‹è¯•æˆåŠŸ: " + timeoutResult);
  } catch (error) {
    MNUtil.log("è¶…æ—¶æµ‹è¯•å¤±è´¥: " + error.message);
  }
}

// è¿è¡Œæœ€ä½³å®è·µç¤ºä¾‹
bestPracticeExample();
```

---

### ç¬¬8ç« å°ç»“

ğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº†å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µï¼

âœ… **å¼‚æ­¥ç¼–ç¨‹åŸºç¡€**ï¼š
- ç†è§£åŒæ­¥ vs å¼‚æ­¥çš„åŒºåˆ«
- æŒæ¡ Promise çš„åŸºæœ¬ç”¨æ³•
- ç†Ÿæ‚‰ async/await è¯­æ³•

âœ… **å®é™…åº”ç”¨**ï¼š
- åœ¨ MarginNote æ’ä»¶ä¸­å¤„ç†è€—æ—¶æ“ä½œ
- æ‰¹é‡å¼‚æ­¥å¤„ç†çš„ä¸¤ç§æ¨¡å¼ï¼ˆé¡ºåº vs å¹¶è¡Œï¼‰
- é”™è¯¯å¤„ç†å’Œè¿›åº¦åé¦ˆ

âœ… **æœ€ä½³å®è·µ**ï¼š
- å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- è¶…æ—¶æ§åˆ¶é¿å…æ— é™ç­‰å¾…
- å¹¶å‘æ§åˆ¶é¿å…è¿‡åº¦è´Ÿè½½
- é‡è¯•æœºåˆ¶æé«˜æˆåŠŸç‡