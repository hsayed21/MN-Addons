# ğŸš€ MNUtils æ’ä»¶å¼€å‘å­¦ä¹ ä¹‹æ—…

> ä»é›¶å¼€å§‹ï¼Œä¸€æ­¥æ­¥ç†è§£ MarginNote æ’ä»¶å¼€å‘çš„å¥¥ç§˜

## ğŸ“– å†™åœ¨å‰é¢

å—¨ï¼æ¬¢è¿æ¥åˆ° MNUtils çš„å­¦ä¹ ä¹‹æ—…ã€‚å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ MarginNote æ’ä»¶å¼€å‘ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šåƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œä¸€å—ä¸€å—åœ°æ„å»ºçŸ¥è¯†ä½“ç³»ã€‚

**è¿™ä¸ªæ–‡æ¡£é€‚åˆè°ï¼Ÿ**
- ğŸŒ± å®Œå…¨æ²¡æœ‰æ’ä»¶å¼€å‘ç»éªŒçš„æ–°æ‰‹
- ğŸ” æƒ³è¦ç†è§£ MNUtils å†…éƒ¨åŸç†çš„å¼€å‘è€…
- ğŸ¯ å¸Œæœ›ä¸º MarginNote å¼€å‘è‡ªå·±æ’ä»¶çš„åˆ›ä½œè€…

---

## ç¬¬1ç« ï¼šä»ä¸€ä¸ªç®€å•çš„éœ€æ±‚å¼€å§‹

### ğŸ¤” æ•…äº‹çš„èµ·ç‚¹

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª MarginNote æ’ä»¶ã€‚çªç„¶ï¼Œæ’ä»¶å‡ºé—®é¢˜äº†ï¼ä½ ä¸çŸ¥é“å“ªé‡Œå‡ºé”™ï¼Œä¹Ÿçœ‹ä¸åˆ°ä»»ä½•é”™è¯¯ä¿¡æ¯ã€‚è¿™æ—¶å€™ï¼Œä½ å¤šå¸Œæœ›æœ‰ä¸ªå·¥å…·èƒ½è®°å½•å¹¶æ˜¾ç¤ºæ‰€æœ‰å‘ç”Ÿçš„äº‹æƒ…...

è¿™å°±æ˜¯ **Log Viewerï¼ˆæ—¥å¿—æŸ¥çœ‹å™¨ï¼‰** è¯ç”Ÿçš„åŸå› ï¼

### ğŸ“ ä»€ä¹ˆæ˜¯æ—¥å¿—ï¼Ÿ

æ—¥å¿—å°±åƒæ˜¯ç¨‹åºçš„**æ—¥è®°æœ¬**ï¼š

```
æ—©ä¸Š 8:00 - ç”¨æˆ·æ‰“å¼€äº†æ’ä»¶ âœ…
æ—©ä¸Š 8:01 - åŠ è½½é…ç½®æ–‡ä»¶ âœ…
æ—©ä¸Š 8:02 - è¿æ¥æœåŠ¡å™¨å¤±è´¥ âŒ
æ—©ä¸Š 8:03 - é‡è¯•è¿æ¥... â³
```

æ¯å½“ç¨‹åºåšäº†ä»€ä¹ˆäº‹ï¼Œæˆ‘ä»¬å°±è®°ä¸€ç¬”ã€‚å‡ºé—®é¢˜æ—¶ï¼Œç¿»ç¿»æ—¥è®°å°±çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚

### ğŸ¯ æˆ‘ä»¬è¦åšä»€ä¹ˆï¼Ÿ

åˆ›å»ºä¸€ä¸ªæ—¥å¿—æŸ¥çœ‹å™¨ï¼Œå®ƒéœ€è¦ï¼š
1. **æ”¶é›†æ—¥å¿—** - ä»å„å¤„æ”¶é›†ä¿¡æ¯
2. **å­˜å‚¨æ—¥å¿—** - æŠŠä¿¡æ¯ä¿å­˜èµ·æ¥
3. **æ˜¾ç¤ºæ—¥å¿—** - ç”¨å‹å¥½çš„ç•Œé¢å±•ç¤º
4. **è¿‡æ»¤æœç´¢** - å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„ä¿¡æ¯

å¬èµ·æ¥ç®€å•ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ï¼

---

## ç¬¬2ç« ï¼šç†è§£ MarginNote æ’ä»¶çš„ä¸–ç•Œ

### ğŸ° ä¸‰å±‚æ¶æ„ - åƒä¸€åº§ä¸‰å±‚æ¥¼çš„æˆ¿å­

MarginNote æ’ä»¶å°±åƒä¸€åº§ä¸‰å±‚æ¥¼çš„æˆ¿å­ï¼š

```
    ğŸ  ä½ çš„æ’ä»¶æˆ¿å­
    
    3æ¥¼ [ Web ç•Œé¢å±‚ ]  ğŸ‘¤ ç”¨æˆ·åœ¨è¿™é‡Œ
       â†•ï¸ æ¥¼æ¢¯(é€šä¿¡)
    2æ¥¼ [ JavaScript ]  ğŸ§  é€»è¾‘åœ¨è¿™é‡Œ
       â†•ï¸ æ¥¼æ¢¯(æ¡¥æ¥)
    1æ¥¼ [ Native åŸç”Ÿ ]  ğŸ’ª ç³»ç»Ÿåœ¨è¿™é‡Œ
```

- **1æ¥¼ï¼ˆNativeï¼‰**ï¼šå’Œ MarginNote ç³»ç»Ÿæ‰“äº¤é“ï¼Œå¾ˆå¼ºå¤§ä½†ä¸å¤Ÿçµæ´»
- **2æ¥¼ï¼ˆJavaScriptï¼‰**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ˜¯æ•´ä¸ªæ’ä»¶çš„å¤§è„‘
- **3æ¥¼ï¼ˆWebï¼‰**ï¼šæ¼‚äº®çš„ç•Œé¢ï¼Œç”¨æˆ·çœ‹åˆ°å’Œæ“ä½œçš„åœ°æ–¹

### ğŸ¤ ä»–ä»¬æ€ä¹ˆäº¤æµï¼Ÿ

å°±åƒæ¥¼å±‚ä¹‹é—´éœ€è¦æ¥¼æ¢¯ï¼Œè¿™ä¸‰å±‚ä¹Ÿéœ€è¦"é€šä¿¡æ–¹å¼"ï¼š

```
ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼ˆ3æ¥¼ï¼‰
    â†“ "è€æ¿è¦çœ‹æ—¥å¿—ï¼"
JavaScriptï¼ˆ2æ¥¼ï¼‰
    â†“ "ç³»ç»Ÿï¼Œç»™æˆ‘æ—¥å¿—æ•°æ®ï¼"
Nativeï¼ˆ1æ¥¼ï¼‰
    â†“ "è¿™æ˜¯æ‰€æœ‰æ—¥å¿—"
JavaScriptï¼ˆ2æ¥¼ï¼‰
    â†“ "æ•´ç†å¥½äº†ï¼Œç»™ç”¨æˆ·çœ‹"
æ˜¾ç¤ºåœ¨ç•Œé¢ï¼ˆ3æ¥¼ï¼‰
```

### ğŸ’¡ ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ

æƒ³è±¡å¦‚æœæ‰€æœ‰åŠŸèƒ½éƒ½æŒ¤åœ¨ä¸€å±‚ï¼š
- âŒ ä»£ç ä¼šå˜å¾—æ··ä¹±
- âŒ ä¿®æ”¹ä¸€å¤„å¯èƒ½å½±å“å…¨éƒ¨
- âŒ éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•

åˆ†å±‚åï¼š
- âœ… å„å¸å…¶èŒï¼Œæ¸…æ™°æ˜äº†
- âœ… å¯ä»¥ç‹¬ç«‹ä¿®æ”¹æŸä¸€å±‚
- âœ… å®¹æ˜“ç†è§£å’Œç»´æŠ¤

---

## ç¬¬3ç« ï¼šåŠ¨æ‰‹å†™ç¬¬ä¸€è¡Œä»£ç 

### ğŸ¬ ä»æœ€ç®€å•çš„æ—¥å¿—ç±»å¼€å§‹

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„æ—¥å¿—ç®¡ç†å™¨ï¼š

```javascript
// è¿™æ˜¯æˆ‘ä»¬çš„æ—¥å¿—ç®¡å®¶
class SimpleLogger {
  constructor() {
    // å‡†å¤‡ä¸€ä¸ªç›’å­è£…æ—¥å¿—
    this.logs = []
  }
  
  // è®°å½•ä¸€æ¡æ—¥å¿—
  log(message) {
    // åˆ›å»ºæ—¥å¿—æ¡ç›®ï¼ˆåƒå†™æ—¥è®°ï¼‰
    const logEntry = {
      message: message,           // è¦è¯´ä»€ä¹ˆ
      time: new Date().toLocaleTimeString()  // å‡ ç‚¹è¯´çš„
    }
    
    // æ”¾è¿›ç›’å­é‡Œ
    this.logs.push(logEntry)
    
    // æ‰“å°å‡ºæ¥çœ‹çœ‹
    console.log(`[${logEntry.time}] ${logEntry.message}`)
  }
  
  // æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
  showAll() {
    console.log("ğŸ“‹ æ‰€æœ‰æ—¥å¿—ï¼š")
    this.logs.forEach(log => {
      console.log(`  [${log.time}] ${log.message}`)
    })
  }
}

// è¯•è¯•çœ‹ï¼
const logger = new SimpleLogger()
logger.log("æ’ä»¶å¯åŠ¨äº†")
logger.log("ç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®")
logger.showAll()
```

### ğŸ® åŠ¨æ‰‹ç»ƒä¹  #1

è¯•ç€ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼Œæ·»åŠ ä¸€ä¸ª"æ—¥å¿—çº§åˆ«"åŠŸèƒ½ï¼š
- INFOï¼ˆæ™®é€šä¿¡æ¯ï¼‰ç”¨ â„¹ï¸
- WARNï¼ˆè­¦å‘Šï¼‰ç”¨ âš ï¸  
- ERRORï¼ˆé”™è¯¯ï¼‰ç”¨ âŒ

<details>
<summary>ğŸ’¡ æç¤ºï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

```javascript
log(message, level = 'INFO') {
  const icons = {
    'INFO': 'â„¹ï¸',
    'WARN': 'âš ï¸',
    'ERROR': 'âŒ'
  }
  // ... ç»§ç»­å®Œæˆ
}
```
</details>

---

## ç¬¬4ç« ï¼šè®©æ—¥å¿—"æ´»"èµ·æ¥ - æ·»åŠ  UI

### ğŸ¨ ä»æ§åˆ¶å°åˆ°ç½‘é¡µ

æ§åˆ¶å°çš„æ—¥å¿—å¤ªæ¯ç‡¥äº†ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¼‚äº®çš„ç½‘é¡µç•Œé¢ï¼

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º HTML ç»“æ„

```html
<!-- è¿™æ˜¯æˆ‘ä»¬çš„æ—¥å¿—å±•ç¤ºèˆå° -->
<!DOCTYPE html>
<html>
<head>
    <title>æˆ‘çš„æ—¥å¿—æŸ¥çœ‹å™¨</title>
    <style>
        /* è£…é¥°æˆ‘ä»¬çš„èˆå° */
        .log-container {
            background: #f5f5f5;
            padding: 10px;
            height: 400px;
            overflow-y: auto;  /* å¤ªå¤šäº†å¯ä»¥æ»šåŠ¨ */
        }
        
        .log-entry {
            background: white;
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;  /* ç”¨ç­‰å®½å­—ä½“ */
        }
        
        /* ä¸åŒçº§åˆ«ä¸åŒé¢œè‰² */
        .log-error { border-left: 3px solid red; }
        .log-warn { border-left: 3px solid orange; }
        .log-info { border-left: 3px solid blue; }
    </style>
</head>
<body>
    <h2>ğŸ“‹ æ—¥å¿—æŸ¥çœ‹å™¨</h2>
    <div id="logContainer" class="log-container">
        <!-- æ—¥å¿—ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
    </div>
</body>
</html>
```

#### ç¬¬äºŒæ­¥ï¼šç”¨ JavaScript æ·»åŠ æ—¥å¿—

```javascript
// ç°åœ¨æˆ‘ä»¬è¦æ“ä½œç½‘é¡µäº†ï¼
class WebLogger {
  constructor(containerId) {
    // æ‰¾åˆ°æ”¾æ—¥å¿—çš„å®¹å™¨
    this.container = document.getElementById(containerId)
  }
  
  // æ·»åŠ ä¸€æ¡æ—¥å¿—åˆ°é¡µé¢
  addLog(message, level = 'info') {
    // åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—å…ƒç´ 
    const logDiv = document.createElement('div')
    logDiv.className = `log-entry log-${level.toLowerCase()}`
    
    // è®¾ç½®å†…å®¹
    const time = new Date().toLocaleTimeString()
    logDiv.textContent = `[${time}] ${message}`
    
    // æ·»åŠ åˆ°å®¹å™¨
    this.container.appendChild(logDiv)
    
    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆçœ‹æœ€æ–°çš„ï¼‰
    this.container.scrollTop = this.container.scrollHeight
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const webLogger = new WebLogger('logContainer')
webLogger.addLog('ç³»ç»Ÿå¯åŠ¨', 'info')
webLogger.addLog('è­¦å‘Šï¼šå†…å­˜ä½¿ç”¨ç‡é«˜', 'warn')
webLogger.addLog('é”™è¯¯ï¼šç½‘ç»œè¿æ¥å¤±è´¥', 'error')
```

### ğŸ¯ ç†è§£å…³é”®æ¦‚å¿µ

**DOM æ“ä½œ** - å°±åƒæ­ç§¯æœ¨
```javascript
document.getElementById('logContainer')  // æ‰¾åˆ°æŒ‡å®šçš„ç§¯æœ¨
document.createElement('div')            // åˆ›å»ºæ–°ç§¯æœ¨
container.appendChild(logDiv)            // æŠŠç§¯æœ¨æ”¾è¿›å»
```

**CSS ç±»å** - å°±åƒè´´æ ‡ç­¾
```javascript
logDiv.className = 'log-entry log-error'  // è´´ä¸Šä¸¤ä¸ªæ ‡ç­¾
// CSS ä¼šæ ¹æ®æ ‡ç­¾æ¥è£…é¥°ï¼šçº¢è‰²è¾¹æ¡†è¡¨ç¤ºé”™è¯¯
```

---

## ç¬¬5ç« ï¼šè¿æ¥ Native å’Œ Web - å»ºç«‹é€šä¿¡æ¡¥æ¢

### ğŸŒ‰ ç†è§£é€šä¿¡çš„æŒ‘æˆ˜

Native å’Œ Web å°±åƒè¯´ä¸åŒè¯­è¨€çš„ä¸¤ä¸ªäººï¼š
- Native è¯´"Objective-C è¯­"
- Web è¯´"JavaScript è¯­"

æˆ‘ä»¬éœ€è¦ä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼

### ğŸ“¡ æ–¹å¼ä¸€ï¼šJavaScript æ³¨å…¥

Native å¯ä»¥å‘ Web é¡µé¢"å–Šè¯"ï¼š

```javascript
// Native ç«¯ï¼šå‘ç½‘é¡µæ³¨å…¥ JavaScript
subscriptionController.prototype.sendLogToWeb = function(log) {
  // å‡†å¤‡è¦è¯´çš„è¯
  const message = JSON.stringify(log)
  
  // ç¼–ç ï¼ˆé˜²æ­¢ç‰¹æ®Šå­—ç¬¦ç ´åï¼‰
  const encoded = encodeURIComponent(message)
  
  // å‘ç½‘é¡µ"å–Šè¯"
  this.webview.runJavaScript(
    `receiveLog('${encoded}')`  // è°ƒç”¨ç½‘é¡µçš„å‡½æ•°
  )
}

// Web ç«¯ï¼šå‡†å¤‡å¥½æ¥æ”¶
function receiveLog(encodedLog) {
  // è§£ç 
  const message = decodeURIComponent(encodedLog)
  const log = JSON.parse(message)
  
  // æ˜¾ç¤ºæ—¥å¿—
  webLogger.addLog(log.message, log.level)
}
```

### ğŸ“¡ æ–¹å¼äºŒï¼šURL Scheme

Web å¯ä»¥é€šè¿‡ç‰¹æ®Šçš„ URL å‘ Native "å‘ä¿¡å·"ï¼š

```javascript
// Web ç«¯ï¼šå‘é€ä¿¡å·
function askForLogs() {
  // æ„é€ ç‰¹æ®Šçš„ URL
  window.location.href = 'mnutils://getLogs'
}

// Native ç«¯ï¼šæ¥æ”¶ä¿¡å·
if (url.startsWith('mnutils://')) {
  const action = url.split('://')[1]
  if (action === 'getLogs') {
    // å‘é€æ—¥å¿—ç»™ Web
    this.sendAllLogs()
  }
}
```

### ğŸ® åŠ¨æ‰‹ç»ƒä¹  #2

ç”»å‡º Native å’Œ Web é€šä¿¡çš„æµç¨‹å›¾ï¼š
1. ç”¨æˆ·ç‚¹å‡»"åˆ·æ–°æ—¥å¿—"æŒ‰é’®
2. Web å‘é€è¯·æ±‚ç»™ Native
3. Native è·å–æ—¥å¿—æ•°æ®
4. Native å‘é€æ•°æ®ç»™ Web
5. Web æ˜¾ç¤ºæ—¥å¿—

<details>
<summary>ğŸ’¡ å‚è€ƒç­”æ¡ˆ</summary>

```
ç”¨æˆ·ç‚¹å‡»æŒ‰é’®
    â†“
[Web] "mnutils://refresh"
    â†“
[Native] æ”¶åˆ°è¯·æ±‚
    â†“
[Native] è·å– MNLog.logs
    â†“
[Native] runJavaScript('showLogs(...)')
    â†“
[Web] æ˜¾ç¤ºæ—¥å¿—
```
</details>

---

## ç¬¬6ç« ï¼šå¤„ç†çœŸå®åœºæ™¯çš„æŒ‘æˆ˜

### ğŸ¯ æŒ‘æˆ˜1ï¼šæ—¥å¿—å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ

æƒ³è±¡æœ‰ 10000 æ¡æ—¥å¿—ï¼Œé—®é¢˜æ¥äº†ï¼š
- ğŸ“± å†…å­˜ä¼šçˆ†æ»¡
- ğŸŒ ç•Œé¢ä¼šå¡é¡¿
- ğŸ˜µ ç”¨æˆ·ä¼šè¿·å¤±

**è§£å†³æ–¹æ¡ˆï¼šå¾ªç¯ç¼“å†²åŒº**

```javascript
class SmartLogger {
  constructor(maxLogs = 1000) {
    this.logs = []
    this.maxLogs = maxLogs  // æœ€å¤šä¿å­˜1000æ¡
  }
  
  log(message) {
    // æ·»åŠ æ–°æ—¥å¿—
    this.logs.push({
      message,
      time: Date.now()
    })
    
    // å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œåˆ é™¤æœ€è€çš„
    if (this.logs.length > this.maxLogs) {
      this.logs.shift()  // åˆ é™¤ç¬¬ä¸€ä¸ªï¼ˆæœ€è€çš„ï¼‰
    }
  }
}
```

è¿™å°±åƒä¸€ä¸ªæ—‹è½¬å¯¿å¸åº—çš„ä¼ é€å¸¦ï¼š
```
æ–°å¯¿å¸ â†’ [ğŸ£ğŸ£ğŸ£ğŸ£ğŸ£] â†’ è€å¯¿å¸è¢«æ‹¿èµ°
```

### ğŸ¯ æŒ‘æˆ˜2ï¼šå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„æ—¥å¿—ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šè¿‡æ»¤ç³»ç»Ÿ**

```javascript
class FilterableLogger {
  // è¿‡æ»¤æ—¥å¿—
  filterLogs(level) {
    return this.logs.filter(log => log.level === level)
  }
  
  // æœç´¢å…³é”®è¯
  searchLogs(keyword) {
    return this.logs.filter(log => 
      log.message.includes(keyword)
    )
  }
  
  // ç»„åˆè¿‡æ»¤
  getFilteredLogs(options) {
    let filtered = this.logs
    
    if (options.level) {
      filtered = filtered.filter(log => 
        log.level === options.level
      )
    }
    
    if (options.keyword) {
      filtered = filtered.filter(log => 
        log.message.includes(options.keyword)
      )
    }
    
    return filtered
  }
}
```

### ğŸ¯ æŒ‘æˆ˜3ï¼šå¦‚ä½•ä¼˜é›…åœ°å¤„ç†é”™è¯¯ï¼Ÿ

```javascript
class SafeLogger {
  log(message) {
    try {
      // æ­£å¸¸è®°å½•
      this.addLog(message)
    } catch (error) {
      // å‡ºé”™äº†ä¹Ÿä¸èƒ½å´©æºƒ
      console.error('è®°å½•æ—¥å¿—æ—¶å‡ºé”™:', error)
      
      // å°è¯•è®°å½•é”™è¯¯æœ¬èº«
      this.emergencyLog({
        message: 'æ—¥å¿—ç³»ç»Ÿé”™è¯¯',
        error: error.toString()
      })
    }
  }
  
  emergencyLog(data) {
    // ç´§æ€¥å¤‡ä»½æ–¹æ¡ˆï¼šå­˜åˆ° localStorage
    const backup = JSON.parse(
      localStorage.getItem('emergency_logs') || '[]'
    )
    backup.push(data)
    localStorage.setItem('emergency_logs', JSON.stringify(backup))
  }
}
```

---

## ç¬¬7ç« ï¼šè°ƒè¯•æŠ€å·§å’Œå¸¸è§é—®é¢˜

### ğŸ› è°ƒè¯•æŠ€å·§

#### 1. ä½¿ç”¨ Safari Web Inspector

```javascript
// åœ¨ä»£ç ä¸­æ·»åŠ æ–­ç‚¹æ ‡è®°
debugger  // ä»£ç ä¼šåœ¨è¿™é‡Œæš‚åœ

// æˆ–è€…æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log('%cé‡è¦ä¿¡æ¯', 'color: red; font-size: 16px')
console.table(this.logs)  // è¡¨æ ¼å½¢å¼æ˜¾ç¤º
```

#### 2. æ·»åŠ è°ƒè¯•æ¨¡å¼

```javascript
class DebugLogger {
  constructor(debug = false) {
    this.debug = debug
  }
  
  log(message, level) {
    // æ­£å¸¸è®°å½•
    this.logs.push({message, level})
    
    // è°ƒè¯•æ¨¡å¼ï¼šé¢å¤–è¾“å‡º
    if (this.debug) {
      console.group(`ğŸ“ æ—¥å¿— [${level}]`)
      console.log('æ¶ˆæ¯:', message)
      console.log('æ—¶é—´:', new Date())
      console.log('è°ƒç”¨æ ˆ:', new Error().stack)
      console.groupEnd()
    }
  }
}
```

### â“ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### Q1: WebView åŠ è½½äº†ä½†çœ‹ä¸åˆ°æ—¥å¿—ï¼Ÿ

**å¯èƒ½åŸå› **ï¼šJavaScript åœ¨ WebView å‡†å¤‡å¥½ä¹‹å‰å°±æ‰§è¡Œäº†

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ·»åŠ å»¶è¿Ÿç­‰å¾…
await MNUtil.delay(0.5)  // ç­‰å¾… 500ms
this.showLog(MNLog.logs)

// æˆ–è€…ç›‘å¬åŠ è½½å®Œæˆäº‹ä»¶
webview.onload = () => {
  this.showLog(MNLog.logs)
}
```

#### Q2: æ—¥å¿—æ˜¾ç¤ºä¹±ç ï¼Ÿ

**å¯èƒ½åŸå› **ï¼šç¼–ç é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// ç¡®ä¿æ­£ç¡®ç¼–ç å’Œè§£ç 
const encoded = encodeURIComponent(JSON.stringify(data))
// ... ä¼ è¾“ ...
const decoded = JSON.parse(decodeURIComponent(encoded))
```

#### Q3: ç‚¹å‡»æŒ‰é’®æ²¡ååº”ï¼Ÿ

**è°ƒè¯•æ­¥éª¤**ï¼š
```javascript
// 1. ç¡®è®¤äº‹ä»¶ç»‘å®š
button.addEventListener('click', (e) => {
  console.log('æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼')  // ç¬¬ä¸€æ­¥ï¼šç¡®è®¤è§¦å‘
  
  // 2. æ£€æŸ¥æ•°æ®
  console.log('å½“å‰æ—¥å¿—æ•°:', this.logs.length)
  
  // 3. è¿½è¸ªæ‰§è¡Œ
  console.log('å¼€å§‹è¿‡æ»¤...')
  const filtered = this.filterLogs()
  console.log('è¿‡æ»¤ç»“æœ:', filtered)
})
```

### ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å°è´´å£«

```javascript
// âŒ ä¸å¥½ï¼šæ¯æ¬¡éƒ½é‡æ–°æ¸²æŸ“æ‰€æœ‰æ—¥å¿—
function showAllLogs() {
  container.innerHTML = ''  // æ¸…ç©º
  logs.forEach(log => {     // é‡æ–°æ·»åŠ å…¨éƒ¨
    container.appendChild(createLogElement(log))
  })
}

// âœ… å¥½ï¼šåªæ·»åŠ æ–°çš„æ—¥å¿—
function appendNewLog(log) {
  // åªåˆ›å»ºå’Œæ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ 
  const element = createLogElement(log)
  container.appendChild(element)
  
  // é™åˆ¶æ˜¾ç¤ºæ•°é‡
  if (container.children.length > 100) {
    container.removeChild(container.firstChild)
  }
}
```

---

## ç¬¬8ç« ï¼šå®æˆ˜é¡¹ç›® - æ„å»ºå®Œæ•´çš„ Log Viewer

### ğŸ¯ é¡¹ç›®ç›®æ ‡

è®©æˆ‘ä»¬æ•´åˆæ‰€å­¦ï¼Œåˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ—¥å¿—æŸ¥çœ‹å™¨ï¼

### ğŸ“‹ åŠŸèƒ½æ¸…å•

- [x] åŸºç¡€æ—¥å¿—è®°å½•
- [x] Web ç•Œé¢æ˜¾ç¤º
- [x] çº§åˆ«è¿‡æ»¤ï¼ˆERROR/WARN/INFOï¼‰
- [x] å…³é”®è¯æœç´¢
- [x] å¤åˆ¶æ—¥å¿—
- [x] æ¸…ç©ºæ—¥å¿—
- [ ] å¯¼å‡ºæ—¥å¿—ï¼ˆç»ƒä¹ ï¼‰
- [ ] æ—¥å¿—ç»Ÿè®¡ï¼ˆç»ƒä¹ ï¼‰

### ğŸ—ï¸ æœ€ç»ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç”¨æˆ·ç•Œé¢ (HTML)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”   â”‚
â”‚  â”‚è¿‡æ»¤â”‚ â”‚æœç´¢â”‚ â”‚å¤åˆ¶â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LogViewer ç±» (JS)      â”‚
â”‚  - æ¸²æŸ“æ—¥å¿—              â”‚
â”‚  - å¤„ç†äº¤äº’              â”‚
â”‚  - ç®¡ç†è¿‡æ»¤              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MNLog ç±» (Native)     â”‚
â”‚  - æ”¶é›†æ—¥å¿—              â”‚
â”‚  - å­˜å‚¨ç®¡ç†              â”‚
â”‚  - æ•°æ®ä¼ è¾“              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ® åŠ¨æ‰‹ç»ƒä¹  #3ï¼šæ·»åŠ å¯¼å‡ºåŠŸèƒ½

æŒ‘æˆ˜ï¼šæ·»åŠ ä¸€ä¸ª"å¯¼å‡º"æŒ‰é’®ï¼Œå¯ä»¥å°†æ—¥å¿—ä¿å­˜ä¸ºæ–‡ä»¶ã€‚

**æç¤ºç»“æ„**ï¼š
```javascript
function exportLogs() {
  // 1. è·å–æ‰€æœ‰æ—¥å¿—
  const logs = logViewer.logs
  
  // 2. è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼
  const text = logs.map(log => 
    `[${log.time}] [${log.level}] ${log.message}`
  ).join('\n')
  
  // 3. åˆ›å»ºä¸‹è½½é“¾æ¥
  const blob = new Blob([text], {type: 'text/plain'})
  const url = URL.createObjectURL(blob)
  
  // 4. è§¦å‘ä¸‹è½½
  const a = document.createElement('a')
  a.href = url
  a.download = 'logs.txt'
  a.click()
}
```

### ğŸ® åŠ¨æ‰‹ç»ƒä¹  #4ï¼šæ·»åŠ ç»Ÿè®¡é¢æ¿

æŒ‘æˆ˜ï¼šæ˜¾ç¤ºæ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ•°ã€å„çº§åˆ«æ•°é‡ã€æœ€å¸¸è§çš„æ¶ˆæ¯ï¼‰ã€‚

**ç•Œé¢æ¨¡æ¿**ï¼š
```html
<div class="stats-panel">
  <h3>ğŸ“Š ç»Ÿè®¡</h3>
  <p>æ€»è®¡: <span id="totalCount">0</span></p>
  <p>é”™è¯¯: <span id="errorCount">0</span></p>
  <p>è­¦å‘Š: <span id="warnCount">0</span></p>
  <p>ä¿¡æ¯: <span id="infoCount">0</span></p>
</div>
```

---

## ğŸ“ æ€»ç»“ï¼šä½ å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ

### âœ… æ ¸å¿ƒæ¦‚å¿µ
1. **ä¸‰å±‚æ¶æ„**ï¼šNative + JavaScript + Web çš„åä½œ
2. **æ•°æ®æµåŠ¨**ï¼šæ—¥å¿—å¦‚ä½•ä»äº§ç”Ÿåˆ°æ˜¾ç¤º
3. **é€šä¿¡æœºåˆ¶**ï¼šä¸åŒå±‚ä¹‹é—´å¦‚ä½•å¯¹è¯
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤„ç†å¤§é‡æ•°æ®çš„æŠ€å·§

### âœ… å®ç”¨æŠ€èƒ½
1. **DOM æ“ä½œ**ï¼šåŠ¨æ€åˆ›å»ºå’Œä¿®æ”¹ç½‘é¡µå…ƒç´ 
2. **äº‹ä»¶å¤„ç†**ï¼šå“åº”ç”¨æˆ·äº¤äº’
3. **æ•°æ®ç®¡ç†**ï¼šè¿‡æ»¤ã€æœç´¢ã€å­˜å‚¨
4. **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…åœ°å¤„ç†å¼‚å¸¸

### âœ… å¼€å‘æ€ç»´
1. **æ¨¡å—åŒ–æ€è€ƒ**ï¼šæŠŠå¤§é—®é¢˜åˆ†è§£æˆå°æ¨¡å—
2. **æ¸è¿›å¼å¼€å‘**ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥å®Œå–„
3. **ç”¨æˆ·ä½“éªŒ**ï¼šå§‹ç»ˆè€ƒè™‘ç”¨æˆ·çš„ä½¿ç”¨æ„Ÿå—
4. **è°ƒè¯•æŠ€å·§**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜

---

## ğŸš€ ä¸‹ä¸€æ­¥

### ç»§ç»­å­¦ä¹ è·¯å¾„

1. **æ·±å…¥ MNUtils å…¶ä»–æ¨¡å—**
   - è®¢é˜…ç®¡ç†ç³»ç»Ÿ
   - æ’ä»¶å•†åº—åŠŸèƒ½
   - ç¬”è®°æ“ä½œ API

2. **åˆ›å»ºè‡ªå·±çš„æ’ä»¶**
   - ä»ç®€å•çš„åŠŸèƒ½å¼€å§‹
   - é€æ­¥å¢åŠ å¤æ‚åº¦
   - å‘å¸ƒåˆ°ç¤¾åŒº

3. **å‚ä¸ç¤¾åŒº**
   - åˆ†äº«ä½ çš„å­¦ä¹ å¿ƒå¾—
   - å¸®åŠ©å…¶ä»–æ–°æ‰‹
   - è´¡çŒ®ä»£ç æ”¹è¿›

### ğŸ“š æ¨èèµ„æº

- [MarginNote å®˜æ–¹æ–‡æ¡£](https://docs.marginnote.com)
- [MNUtils API å‚è€ƒ](./MNUtils_API_Guide.md)
- [JavaScript MDN æ–‡æ¡£](https://developer.mozilla.org)

### ğŸ’¬ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜æ—¶ï¼š
1. å…ˆæ£€æŸ¥é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£
3. æœç´¢ç±»ä¼¼é—®é¢˜
4. å‘ç¤¾åŒºæ±‚åŠ©

---

## ğŸ‰ æ­å–œï¼

ä½ å·²ç»å®Œæˆäº† Log Viewer çš„å­¦ä¹ ä¹‹æ—…ï¼ç°åœ¨ä½ ç†è§£äº†ï¼š
- MarginNote æ’ä»¶çš„åŸºæœ¬æ¶æ„
- Native å’Œ Web çš„é€šä¿¡æ–¹å¼
- å¦‚ä½•æ„å»ºç”¨æˆ·ç•Œé¢
- å¦‚ä½•å¤„ç†å’Œæ˜¾ç¤ºæ•°æ®

**è®°ä½**ï¼šç¼–ç¨‹å°±åƒå­¦éª‘è‡ªè¡Œè½¦ï¼Œå¤šç»ƒä¹ å°±ä¼šè¶Šæ¥è¶Šç†Ÿç»ƒã€‚

ç¥ä½ åœ¨ MarginNote æ’ä»¶å¼€å‘çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œï¼ ğŸš€

---

> ğŸ“ **ç¬”è®°ç©ºé—´**
> 
> åœ¨è¿™é‡Œè®°å½•ä½ çš„å­¦ä¹ å¿ƒå¾—ã€é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š
> 
> 
> 
> 
> 

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿åé¦ˆå’Œå»ºè®®ï¼*