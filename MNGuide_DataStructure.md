MarginNote 4: Understanding Knowledge Management Systems from a Data Structure Perspective #1 Why Understand MarginNote 4 from a Data Structure Perspective?

MarginNote 4 is more than just a PDF reader or note-taking software; it's essentially a **data-structure-based knowledge management system. Understanding its data model is key to understanding the software's core design philosophy:

Atomicization of knowledge: Decomposing knowledge into the smallest manageable unit (card).
- **Structured Knowledge**: Building a knowledge system through relational networks - **Fluid Knowledge**: The same data can flow freely between different views - **Computable Knowledge**: tracking supporting, linking, and automated processing This document will delve into MarginNote 4's three-tiered data architecture to help developers and AI systems understand and operate this powerful knowledge management platform.

---

#2 Core Data Structure Explained #2.1 Card - The Atomic Unit of Knowledge Cards are the most basic data units in MarginNote 4, and all knowledge management revolves around cards.

2.1.1 Card Identification System
Data structures:
{
  id: String, // Format: "E097A792-4E65-46B5-834B-BDDC8A71E254"
  url: String, // Format: "marginnote4app://note/{id}"
  createdAt: Timestamp, // Creation time modifiedAt: Timestamp, // Last modified time version: Integer // Version number (used for resolving for simultaneous conflicts)
}
"```

**Unique Identifier (ID)**
- Each card has a globally unique UUID.
Format conforms to the standard UUID v4 specification - Remains unchanged throughout the system lifecycle - Used for precise location **URL Scheme** across learning sets and devices
- Provides a system-level card access protocol - Supports direct navigation from external applications to specific cards - Format: `marginnote4app://note/{card ID}`
- Can be embedded into other applications to achieve bidirectional links####2.1.2 Card Content Structure`````
Data structures:
{
  The title: {
    text: String, // Plain text, maximum 250 characters isAutoGenerated: Boolean, // Whether to automatically generate source: Enum // Source: manual input/excerpt conversion/OCR extraction},

  Excludeds: [{
    content: String, // The original content extracted type: Enum, // Type: text/image/mixed source: {
      documentId: String,
      pageNumber: Integer,
      coordinates: Rectangle, // Position on the page timestamp: Timestamp
    },
    ocr: { // OCR information (if it's an image)
      text: String,
      Confidence: Float
    }
  }],

  Comments: [{
    type: Enum, // Type: text/handwritten/audio/image/link content: Any, // Stores different based formats on type markdown: Boolean, // Whether to enable Markdown
    timestamp: timestamp,
    author: String // Creator identifier]
}
"```

Three-Tier Content Architecture

1. **Title level**
   - Brief description of the card - Limited to 250 characters to ensure conciseness - Supports automatic extraction (first line text/OCR)
   Display the text as nodes in the mind map. 2. The Excerpt Layer**
   - Extracts original content from the source document - Preserves the original text's integrity - Supports merging multiple excerpts (continuous excerpts)
   Record the precise source location for backtracking. 3. **Comments**
   - User's personal understanding and additions - Supports rich media (text/handwriting/voice/images)
   - Supports Markdown and LaTeX formulas - Can be applied infinitely to form thoughts decisions #####2.1.3 Card Metadata````
Data structures:
{
  An array of tags, supporting hierarchical levels (separated by /).
  color: {
    value: String, // color value (HEX)
    style: Enum // Fill style: solid/border/border + fill},
  Highlights: [{ // Highlights/Fill in the blanks range: Range, // Text range type: Enum // Type: Highlights/Fill in the blanks}],
  masks: [{ // Occlusion information area: Rectangle, // Occlusion area type: Enum // Type: global/local}]
}
"```

Card Polymorphism: Cards take on different forms in different contexts:

"```
State machine:
                    ‚îå--------------------------------------------------------
                    ‚îÇ Original Card ‚îÇ
                    ‚îî- ‚îò
                           ‚îÇ
        ‚îå - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
        üôÇ üôÇ üôÇ üôÇ
  ‚îå----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ‚îÇDocument Excerpt Cards‚îÇ ‚îÇ ‚îÇ Mind Map Node Cards ‚îÇ ‚îÇ Review Flashcards ‚îÇ
  ‚îî-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        ‚îÇ ‚îÇ ‚îÇ ‚îÇ
        ‚îî-----------------------------------------------------------------------------------------------------------------------------------------------------------
                           ‚Üì
                    ‚îå--------------------------------------------------------
                    ‚îÇ Unified Card Pool ‚îÇ
                    ‚îî--------------------------------------------------------
"```

**Morphological Characteristics**

1. **Document Excerpt Cards**
   - Displayed at the edge of the document page - Maintains visual connection with the original text - Supports in-place editing 2. Mind Map Node Cards**
   - Serves as a node in a mind map - Supports hierarchical relationships - Can be freely arranged 3. **Review Flashcards**
   Front and back structure (questions/answers)
   - Supports occlusion and fill-in-the-blank - Records review history 4. **Blank Cards**
   - Special blank cards - can be embedded, pop-up, or displayed on the margin - used to supplement notes ####2.1.5 Card Relationship Network
Relationship type:
{
  Hierarchical relationship parent: CardId,
    children: [CardId],
    order: Integer // Sort by users},

  links: [{ // Link relationships target: CardId,
    type: Enum, // One-way/two-way annotation: String, // Link annotation style: Object // Link line style},

  references: { // Reference relationship original: CardId, // Original card clones: [CardId], // Clones mirrors: [CardId] // Reference mirrors }
}
"```

**Detailed Explanation of Relationship Types

1. Parent-child relationship (tree structure)**
   - Construct knowledge hierarchy - Supports arbitrary nesting depth - Collapsible/expandable display - Supports batch operations on subtrees 2. Link relationships (network structure)**
   - Constructing a conceptual network - One-way link: A ‚Üí B
   - Two-way link: A‚ÜîB
   - Supports links comments 3. Referencing relationships (mirror structure)**
   Cloning: Independent copy, modifications are not synchronized - References: Real-time mirror, modifications are synchronized - Deleting the original card will affect all references - Supports cross-learning sets references ## 2.2 Documents - The carrier of knowledge documents are the original source of knowledge. MarginNote 4 abstracts them into annotable, searchable, and virtualizable data structure.

2.2.1 Basic Document Model
Data structures:
{
  id: String, // Document unique identifier metadata: {
    The title: String,
    author: String,
    format: Enum, // PDF/EPUB/Video/Audio pages: Integer, // Number of pages/duration size: Integer, // file size hash: String // File hash (used for deduplication)
  },

  Storage: {
    // Local/iCloud/External path: String, // Storage path isVirtual: Boolean, // it is a virtual document source: [DocumentId] // The source document of the virtual document}

  status: {
    inStudySet: Boolean,
    syncEnabled: Boolean,
    lastOpened: Timestamp,
    readingProgress: Float
  }
}
"```

2.2.2 Document Organization System
Organizational structure:
{
  categories: [{ // Category id: String,
    name: String,
    parent: CategoryId, // Supports multi-level categories documents: [DocumentId],
    color: String
  }],

  folders: [{ // Folder system ID: String,
    name: String,
    path: String, // Folder path parent: FolderId,
    documents: [DocumentId],
    type: Enum // Local/iCloud/External},

  library: { // Document library documents: [DocumentId],
    index: Object, // Full-text index cache: Object // Thumbnail cache
}
"```

Differences between the three organizational methods

1. **Categories**
   Logical grouping; a document can belong to multiple categories. - Does not affect the actual storage location of the file. - Supports color coding and hierarchical structure. 2. **Folders**
   - Physical storage structure - A document can only reside in one folder - Supports local/cloud/ external storage 3. **Document Library**
   Central repository for all imported documents - Provides global search and indexing - Documents can be referenced by multiple learning sets ####2.2.3 Document Annotation Layer
Annotated Data Structure:
{
  annotations: [{
    id: String,
    type: Enum, // Excerpt/Handwritten/Blank space pageNumber: Integer,
    Position: Rectangle,
    layer: String, // The layer to which it belongs; content: Object, // Label content; linkedCard: CardId // The associated card.

  handwritingLayers: [{ // Handwriting layer id: String,
    name: String,
    strokes: [Stroke], // Stroke data isVisible: Boolean,
    opacity: Float
  }],

  whitespace: [{ // Whitespace system id: String,
    mode: Enum, // pop-up/embedded/margin content: Object,
    state: Enum // Expand/Collapse}]
}
"```

Document Virtualization MarginNote 4 supports the creation of virtual documents, enabling flexible document reorganization:

"```
The Virtual Document Structure:
{
  virtualDocument: {
    id: String,
    name: String,
    segments: [{ // fragment sourceDocument: DocumentId,
      pageRange: Range,
      Filed to:Integer
    }],
    istemporary: Boolean
  }
}
"```

**Virtualization Application Scenarios**
- Cross-document topic organization - Create custom reading order - Create cured resource sets - Temporary comparative reading ## 2.3 Study Set - Knowledge workspace study set is a core concept in MarginNote 4, defining a complete learning context.

2.3.1 Learning Set Data Model
Data structures:
{
  id: String,
  name: String,
  Created by: Timestamp,
  Modified: timestamp,

  components: {
    documents: [{ // document section documentId: String,
      AddedDate: Timestamp,
      isActive: Boolean
    }],

    mindmaps: { // Mind map modules main: MindMapId,
      sub: [SubMindMapId],
      activeMap: MindMapId
    },

    review: { // review section cardGroups: [CardGroupId],
      schedule: Object, // FSRS algorithm parameters statistics: Object
    }
  },

  Filed to: {
    Sync: {
      Filed to:Boolean,
      lastSync: timestamp,
      conflicts: [Object]
    },

    dictionary: { // title link dictionary internal: [MindMapId],
      external: [StudySetId],
      keywords: [String]
    },

    database: { // Database ID: String,
      encrypted: Boolean,
      License: String
    }
  }
}
"```

2.3.2 Scope of the Learning Set
Scope control:
{
  isolation: { // Data isolation level: Enum, // Full isolation/partial sharing/Full sharing sharedCards: [CardId],
    sharedDocuments: [DocumentId]
  },

  permissions: { // Access control read: Boolean,
    by Boolean,
    export: Boolean,
    share: Boolean
  },

  References: { // External references dictionaries: [StudySetId], // External dictionaries referenced linkedSets: [StudySetSets], // Associated study sets sharedCards: [CardId] // Shared cards }
}
"```

2.3.3 Lifecycle of the Learning Set
State machine:
Create ‚Üí Activate ‚Üí Edit ‚Üí Sync ‚Üí Archive ‚Üí Delete ‚Üë ‚Üì
  ‚îî--Restore ‚Üê ---
"```

Data Operations at Each Stage

1. **Creation phase**
   Assign a unique ID
   - Initialize the three main modules - Set default configuration 2. Activity Phase**
   - Load into memory - Build index - Restore to previous state 3. *Editing stage**
   - Save changes in real time - Maintain the undo stack - Trigger automatic backup 4. Synchronization Phase**
   Calculate acne - Resolve conflicts - Update to cloud 5. The archiving phase**
   - Compress data - Clear cache - Save snapshot
