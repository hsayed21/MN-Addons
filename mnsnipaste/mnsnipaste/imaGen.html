<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dream AI Input</title>
  <style>
    /* --- 1. å…¨å±€è®¾ç½® --- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
    }

    body {
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      padding-bottom: 40px;
    }

    /* --- 2. å¦‚æ¢¦å¦‚å¹»çš„æµåŠ¨èƒŒæ™¯ --- */
    .dream-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(125deg, rgb(144, 199, 255), rgb(255, 170, 165), rgb(53, 174, 255), rgb(221, 141, 255), rgb(131, 162, 192));
      background-size: 400% 400%;
      animation: flowAnimation 20s ease infinite;
      z-index: -1;
    }

    @keyframes flowAnimation {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .dream-bg::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuMDUiLz4KPC9zdmc+');
      opacity: 0.3;
    }

    /* --- 3. æ ¸å¿ƒè¾“å…¥åŒºåŸŸ --- */
    .input-wrapper {
      position: relative;
      width: 90%;
      max-width: 600px;
      min-width: 0;
      /* ç¡®ä¿å®½åº¦è®¡ç®—ä¸å—å­å…ƒç´ å½±å“ */
      box-sizing: border-box;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 35px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 10;
      /* ç¡®ä¿åœ¨æ°”æ³¡ä¹‹ä¸Š */
      /* ç¡®ä¿å­å…ƒç´ çš„ç»å¯¹å®šä½ä¸å½±å“å®¹å™¨å®½åº¦ */
      overflow: visible;
    }

    .input-wrapper:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
      border-color: rgba(255, 255, 255, 0.3);
    }

    textarea {
      width: 100%;
      height: 200px;
      background: transparent;
      border: none;
      outline: none;
      resize: none;
      padding: 30px;
      line-height: 1.8;
      font-size: 20px;
      font-weight: 400;
      letter-spacing: 1px;
      color: rgba(255, 255, 255, 0.9);
      text-shadow:
        0 0 10px rgba(255, 255, 255, 0.3),
        1px 1px 2px rgba(0, 0, 0, 0.1);
      caret-color: #fff;
    }

    textarea::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    /* --- 4. æŒ‰é’®æ ·å¼ --- */
    .model-select-btn {
      position: absolute;
      bottom: 15px;
      left: 15px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(100, 200, 255, 0.2);
      color: white;
      cursor: pointer;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0.8;
      visibility: visible;
      transform: scale(1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      transition: 
        opacity 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.1),
        visibility 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.1),
        transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.1),
        all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      overflow: hidden;
      z-index: 100;
    }

    .model-select-btn svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
      transition: all 0.4s ease;
    }

    .model-select-btn:hover {
      width: 300px;
      border-radius: 100px;
      background: rgba(100, 200, 255, 0.9);
    }

    .model-select-btn:hover svg {
      display: none;
    }

    .model-name-text {
      max-width: 0;
      overflow: hidden;
      white-space: nowrap;
      opacity: 0;
      margin-left: 0;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.4s ease;
    }

    .model-select-btn:hover .model-name-text {
      max-width: 260px;
      opacity: 1;
      margin-left: 8px;
    }

    .generate-btn {
      position: absolute;
      bottom: 15px;
      right: 15px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(238, 0, 255, 0.2);
      color: white;
      cursor: pointer;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0.8;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow: hidden;
    }

    .generate-btn svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
    }

    .generate-btn:hover {
      width: 120px;
      border-radius: 30px;
    }

    .btn-text {
      max-width: 0;
      overflow: hidden;
      white-space: nowrap;
      opacity: 0;
      margin-left: 0;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.4s ease;
    }

    .generate-btn:hover .btn-text {
      max-width: 100px;
      opacity: 1;
      margin-left: 8px;
    }

    .generate-btn:hover svg {
      transform: rotate(15deg) scale(1.1);
    }

    .generate-btn:active {
      transform: scale(0.95);
    }

    .model-select-btn:active {
      transform: scale(0.95);
    }

    /* å½“èœå•æ¿€æ´»æ—¶ï¼Œéšè—æŒ‰é’®ï¼ˆå®ç°æŒ‰é’®åˆ°èœå•çš„è½¬å˜ï¼‰ */
    .input-wrapper:has(.model-menu.active) .model-select-btn,
    .model-select-btn.menu-active {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: scale(0);
      /* æŒ‰é’®æ¶ˆå¤±çš„åŠ¨ç”»åº”è¯¥å’Œèœå•å±•å¼€çš„åŠ¨ç”»åŒæ­¥ */
      transition: 
        opacity 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
        visibility 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
        transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå• */
    .model-menu {
      position: absolute;
      /* åˆå§‹çŠ¶æ€ï¼šå’ŒæŒ‰é’®å®Œå…¨ä¸€æ ·çš„ä½ç½®å’Œå¤§å° */
      bottom: 15px;
      left: 15px;
      width: 50px;
      height: 50px;
      min-width: 50px;
      max-width: 50px;
      max-height: 50px;
      background: rgba(134, 163, 191, 0.5);
      border-radius: 25px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      opacity: 0;
      visibility: hidden;
      /* ä»æŒ‰é’®ä¸­å¿ƒå¼€å§‹å±•å¼€ */
      transform-origin: center bottom;
      /* æ¶²æ€ç»ç’ƒå±•å¼€æ•ˆæœï¼šä»åœ†å½¢åˆ°çŸ©å½¢çš„ clip-path åŠ¨ç”» - æŒ‰é’®ä¸­å¿ƒåœ¨ 25px from left, ä»åº•éƒ¨ 25px */
      clip-path: circle(25px at 25px 100%);
      /* ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ */
      will-change: width, height, max-width, max-height, clip-path, transform;
      transition: 
        opacity 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
        visibility 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
        height 1s cubic-bezier(0.34, 1.56, 0.64, 1),
        bottom 1s cubic-bezier(0.34, 1.56, 0.64, 1),
        left 1s cubic-bezier(0.34, 1.56, 0.64, 1),
        clip-path 1s cubic-bezier(0.34, 1.56, 0.64, 1),
        backdrop-filter 0.8s ease,
        box-shadow 0.8s ease,
        border-radius 0.75s ease-out 0.05s;
      overflow: hidden;
      z-index: 1000;
      pointer-events: none;
    }

    /* æ¶²æ€ç»ç’ƒå±•å¼€æ—¶çš„ä¼ªå…ƒç´ ï¼Œå¢å¼ºæµåŠ¨æ•ˆæœ */
    .model-menu::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.1) 0%,
        rgba(255, 255, 255, 0.05) 50%,
        rgba(255, 255, 255, 0.1) 100%
      );
      border-radius: 15px;
      opacity: 0;
      transform: scale(0.8);
      transition: 
        opacity 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
        transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: none;
      z-index: -1;
    }

    /* æµåŠ¨çš„å…‰æ³½æ•ˆæœï¼Œæ¨¡æ‹Ÿæ¶²æ€ç»ç’ƒçš„æµåŠ¨ */
    .model-menu::after {
      content: '';
      position: absolute;
      top: -50%;
      left: 50%;
      width: 200px;
      height: 200%;
      background: linear-gradient(
        180deg,
        transparent 0%,
        rgba(255, 255, 255, 0.15) 30%,
        rgba(255, 255, 255, 0.25) 50%,
        rgba(255, 255, 255, 0.15) 70%,
        transparent 100%
      );
      border-radius: 50%;
      transform: translateX(-50%) scale(0);
      transform-origin: center bottom;
      opacity: 0;
      pointer-events: none;
      z-index: 1;
    }

    @keyframes liquidFlow {
      0% {
        transform: translateX(-50%) scale(0) translateY(0);
        opacity: 0;
      }
      30% {
        opacity: 0.8;
      }
      60% {
        opacity: 0.6;
      }
      100% {
        transform: translateX(-50%) scale(2.5) translateY(-30%);
        opacity: 0;
      }
    }

    .model-menu.active::after {
      animation: liquidFlow 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 0.15s;
    }

    .model-menu.active {
      opacity: 1;
      visibility: visible;
      /* å±•å¼€åˆ°å®Œæ•´èœå•çš„ä½ç½®å’Œå¤§å° */
      width: 330px;
      max-width: 330px;
      height: auto;
      max-height: 500px;
      min-width: 180px;
      bottom: 20px;
      left: 20px;
      /* å±•å¼€åˆ°å®Œæ•´çš„çŸ©å½¢ - ä»æŒ‰é’®ä¸­å¿ƒï¼ˆ40px from left edgeï¼‰å¼€å§‹å±•å¼€ */
      /* ä½¿ç”¨æ›´å¤§çš„åŠå¾„ç¡®ä¿å®Œå…¨è¦†ç›–èœå• */
      clip-path: circle(1000px at 40px 100%);
      border-radius: 25px;
      pointer-events: auto;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      overflow-y: auto;
    }

    .model-menu.active::before {
      opacity: 1;
      transform: scale(1);
    }

    /* å…³é—­åŠ¨ç”»ï¼šæ”¶ç¼©å›æŒ‰é’®ä½ç½®å’Œå¤§å° */
    .model-menu:not(.active) {
      opacity: 0;
      width: 50px;
      max-width: 50px;
      height: 50px;
      max-height: 50px;
      min-width: 50px;
      bottom: 15px;
      left: 15px;
      clip-path: circle(25px at 25px 100%);
      border-radius: 25px;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .model-menu:not(.active)::before {
      opacity: 0;
      transform: scale(0.8);
    }

    .model-menu-item {
      padding: 8px 15px;
      color: rgba(255, 255, 255, 0.9);
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      opacity: 0;
      transform: scale(0.8);
      transition: 
        opacity 0.3s ease 0.2s,
        transform 0.3s ease 0.2s,
        all 0.2s ease;
    }

    .model-menu.active .model-menu-item {
      opacity: 1;
      transform: scale(1);
    }

    .model-menu-item:last-child {
      border-bottom: none;
    }

    .model-menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      padding-left: 25px;
    }

    .model-menu-item.selected {
      background: rgba(67, 137, 175, 0.4);
      color: rgba(100, 200, 255, 1);
      font-weight: 600;
    }

    .model-menu-item.selected::after {
      content: 'âœ“';
      color: rgba(100, 200, 255, 1);
      font-size: 16px;
    }

    /* æ³¡æ³¡æ•ˆæœ */
    .bubbles {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      top: 0;
      left: 0;
    }

    .bubble {
      position: absolute;
      bottom: -100px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: rise 10s infinite ease-in;
    }

    .bubble:nth-child(1) {
      width: 40px;
      height: 40px;
      left: 10%;
      animation-duration: 8s;
    }

    .bubble:nth-child(2) {
      width: 20px;
      height: 20px;
      left: 20%;
      animation-duration: 5s;
      animation-delay: 1s;
    }

    .bubble:nth-child(3) {
      width: 50px;
      height: 50px;
      left: 35%;
      animation-duration: 7s;
      animation-delay: 2s;
    }

    .bubble:nth-child(4) {
      width: 80px;
      height: 80px;
      left: 50%;
      animation-duration: 11s;
      animation-delay: 0s;
    }

    .bubble:nth-child(5) {
      width: 35px;
      height: 35px;
      left: 55%;
      animation-duration: 6s;
      animation-delay: 1s;
    }

    .bubble:nth-child(6) {
      width: 45px;
      height: 45px;
      left: 65%;
      animation-duration: 8s;
      animation-delay: 3s;
    }

    .bubble:nth-child(7) {
      width: 25px;
      height: 25px;
      left: 75%;
      animation-duration: 7s;
      animation-delay: 2s;
    }

    .bubble:nth-child(8) {
      width: 80px;
      height: 80px;
      left: 80%;
      animation-duration: 6s;
      animation-delay: 1s;
    }

    .bubble:nth-child(9) {
      width: 15px;
      height: 15px;
      left: 70%;
      animation-duration: 9s;
      animation-delay: 0s;
    }

    .bubble:nth-child(10) {
      width: 50px;
      height: 50px;
      left: 85%;
      animation-duration: 5s;
      animation-delay: 3s;
    }

    @keyframes rise {
      0% {
        bottom: -100px;
        transform: translateX(0);
      }

      50% {
        transform: translateX(100px);
      }

      100% {
        bottom: 1080px;
        transform: translateX(-200px);
      }
    }

    /* =========================================
           ä¿®æ”¹ç‚¹ï¼šLoading åŠ è½½å±‚è¿‡æ¸¡åŠ¨ç”»ä¼˜åŒ–
           ========================================= */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;

      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;

      /* åˆå§‹çŠ¶æ€ï¼šå®Œå…¨é€æ˜ï¼Œæ— æ¨¡ç³Šï¼Œç¨å¾®æ”¾å¤§(scale 1.2) */
      opacity: 0;
      visibility: hidden;
      background: rgba(0, 0, 0, 0);
      /* åˆå§‹èƒŒæ™¯é€æ˜ */
      backdrop-filter: blur(0px);
      /* åˆå§‹æ— æ¨¡ç³Š */
      -webkit-backdrop-filter: blur(0px);
      transform: scale(1.2);
      /* åˆå§‹æ”¾å¤§ */

      /* ç»Ÿä¸€æ·»åŠ è¿‡æ¸¡æ•ˆæœï¼š1ç§’ï¼Œè´å¡å°”æ›²çº¿è®©åŠ¨æ„Ÿæ›´å¼º */
      transition:
        opacity 1s ease,
        visibility 1s ease,
        background 1s ease,
        backdrop-filter 1s ease,
        transform 1s ease;
    }

    .loading-overlay.active {
      /* æ¿€æ´»çŠ¶æ€ï¼šä¸é€æ˜ï¼Œæ·±åº¦æ¨¡ç³Šï¼Œæ¢å¤åŸå¤§å° */
      opacity: 1;
      visibility: visible;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(15px);
      /* è¿‡æ¸¡åˆ°æ¨¡ç³Š */
      -webkit-backdrop-filter: blur(15px);
      transform: scale(1);
      /* æ¢å¤æ­£å¸¸æ¯”ä¾‹ */
    }

    /* æ—‹è½¬çš„åœˆåœˆ */
    .spinner {
      width: 80px;
      height: 80px;
      border: 8px solid rgba(255, 255, 255, 0.2);
      border-top: 8px solid rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      color: rgba(207, 207, 207, 0.8);
      font-size: 30px;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      font-weight: 300;
      animation: breathe 2.5s ease-in-out infinite;
      font-weight: 600;
    }

    @keyframes breathe {

      0%,
      100% {
        opacity: 0.2;
      }

      50% {
        opacity: 1;
      }
    }
  </style>
</head>

<body>

  <div class="dream-bg"></div>
  <div class="bubbles">
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
  </div>

  <!-- æ–°å¢ï¼šLoading ç»“æ„ -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-text">Drawing...</div>
  </div>

  <div class="input-wrapper">
    <textarea id="promptInput" placeholder="ä¸€åªåœ¨èµ›åšæœ‹å…‹åŸå¸‚å±‹é¡¶ä¸Šçœ‹æ˜Ÿæ˜Ÿçš„çŒ«"></textarea>

    <button class="model-select-btn" id="modelSelectBtn" onclick="toggleModelMenu()">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      <span class="model-name-text" id="modelNameText">DALL-E</span>
    </button>
    <div class="model-menu" id="modelMenu">
      <!-- æ¨¡å‹èœå•é¡¹å°†æ ¹æ® modelNames åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <button class="generate-btn" onclick="generateImage()">
      <svg viewBox="0 0 24 24">
        <path d="M7.5,5.6L5,7l1.4-2.5L5,2l2.5,1.4L10,2L8.6,4.5L10,7L7.5,5.6z M19,2l-1.4,2.5L15.1,5.9l2.5,1.4L19,10l1.4-2.7
                l2.5-1.4l-2.5-1.4L19,2z M13.2,8.4l-1.3-1.3c-0.4-0.4-1-0.4-1.4,0L2.4,15.2c-0.4,0.4-0.4,1,0,1.4l1.3,1.3
                c0.4,0.4,1,0.4,1.4,0l8.1-8.1C13.6,9.4,13.6,8.8,13.2,8.4z M18.6,13.6L13,19.2L19.2,13.6z M20.5,11.5l-1.6,1.6
                l-1.1-1.1l-2.6,2.6l5.9,5.9l2.6-2.6L20.5,11.5z" />
      </svg>
      <span class="btn-text">ç”Ÿæˆ</span>
    </button>
  </div>

  <script>
    // å½“å‰é€‰æ‹©çš„æ¨¡å‹
    let currentModel = 'cogview-3-flash';

    // æ¨¡å‹åç§°æ˜ å°„
    const modelNames = {
      'cogview-3-flash': 'ğŸ†“  CogView-3 Flash',
      'qwen-image': 'ğŸ†“  Qwen-Image',
      "cogview-4-250304":"âœ¨  CogView-4 (0.06)",
      "gemini-2.5-flash-image":"âœ¨  Gemini-2.5 Flash Image (0.01)",
      "gemini-3-pro-image-preview":"âœ¨  Gemini-3 Pro Image (0.1)",
      "gemini-3-pro-image-preview-4k":"âœ¨  Gemini-3 Pro Image 4K (0.15)",
      "gpt-image-1":"âœ¨  GPT Image-1 (0.01)"
    };
    function setCurrentModel(model) {
      if (!modelNames.hasOwnProperty(model)) {
        console.warn(`æ¨¡å‹ "${model}" ä¸å­˜åœ¨äº modelNames ä¸­`);
        return;
      }
      currentModel = model;
      refreshModelSelection();
    }
    function setLastPrompt(encodedPrompt) {
      let prompt = decodeURIComponent(encodedPrompt);
      const input = document.getElementById('promptInput');
      if (input) {
        input.value = prompt;
      }
    }

    // åˆå§‹åŒ–æ¨¡å‹é…ç½®ï¼šç¡®ä¿ currentModel åœ¨ modelNames ä¸­å­˜åœ¨
    function initializeModelConfig() {
      // å¦‚æœ currentModel ä¸åœ¨ modelNames ä¸­ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ¨¡å‹
      if (!modelNames.hasOwnProperty(currentModel)) {
        const firstModel = Object.keys(modelNames)[0];
        if (firstModel) {
          currentModel = firstModel;
        }
      }
    }

    // æ ¹æ® modelNames åŠ¨æ€ç”Ÿæˆæ¨¡å‹èœå•
    function refreshModelMenu() {
      const menu = document.getElementById('modelMenu');
      if (!menu) return;

      // æ¸…ç©ºç°æœ‰èœå•é¡¹
      menu.innerHTML = '';

      // æ ¹æ® modelNames ç”Ÿæˆèœå•é¡¹
      Object.keys(modelNames).forEach(modelKey => {
        const menuItem = document.createElement('div');
        menuItem.className = 'model-menu-item';
        menuItem.setAttribute('data-model', modelKey);
        menuItem.onclick = () => selectModel(modelKey);
        
        // å¦‚æœæ˜¯å½“å‰é€‰ä¸­çš„æ¨¡å‹ï¼Œæ·»åŠ  selected ç±»
        if (modelKey === currentModel) {
          menuItem.classList.add('selected');
        }

        const span = document.createElement('span');
        span.textContent = modelNames[modelKey];
        menuItem.appendChild(span);

        menu.appendChild(menuItem);
      });
    }

    // æ›´æ–°æŒ‰é’®æ˜¾ç¤ºçš„æ¨¡å‹åç§°
    function updateModelName() {
      const modelNameText = document.getElementById('modelNameText');
      if (modelNameText) {
        modelNameText.textContent = modelNames[currentModel] || currentModel;
      }
    }

    // åˆ·æ–°æ¨¡å‹é€‰æ‹©æŒ‰é’®å’Œèœå•ï¼ˆæ ¹æ® modelNames å’Œ currentModelï¼‰
    function refreshModelSelection() {
      updateModelName();
      refreshModelMenu();
    }

    // åˆ‡æ¢æ¨¡å‹èœå•æ˜¾ç¤º/éšè—
    function toggleModelMenu() {
      const menu = document.getElementById('modelMenu');
      const btn = document.getElementById('modelSelectBtn');
      const isActive = menu.classList.toggle('active');
      
      // å½“èœå•æ¿€æ´»æ—¶ï¼Œéšè—æŒ‰é’®ï¼›å…³é—­æ—¶ï¼Œæ˜¾ç¤ºæŒ‰é’®
      if (isActive) {
        btn.classList.add('menu-active');
      } else {
        btn.classList.remove('menu-active');
      }
    }

    // é€‰æ‹©æ¨¡å‹
    function selectModel(model) {
      // éªŒè¯æ¨¡å‹æ˜¯å¦å­˜åœ¨äº modelNames ä¸­
      if (!modelNames.hasOwnProperty(model)) {
        console.warn(`æ¨¡å‹ "${model}" ä¸å­˜åœ¨äº modelNames ä¸­`);
        return;
      }

      currentModel = model;
      
      // åˆ·æ–°æ¨¡å‹é€‰æ‹©æŒ‰é’®å’Œèœå•
      refreshModelSelection();

      // å…³é—­èœå• - å»¶è¿Ÿå…³é—­ä»¥æ˜¾ç¤ºé€‰æ‹©åé¦ˆï¼Œç„¶åè§¦å‘æµç•…çš„å…³é—­åŠ¨ç”»
      const menu = document.getElementById('modelMenu');
      const btn = document.getElementById('modelSelectBtn');
      setTimeout(() => {
        menu.classList.remove('active');
        btn.classList.remove('menu-active');
        postMessageToAddon('snipaste', 'setCurrentModel', undefined, { 
          model: currentModel 
        })
      }, 150);
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    initializeModelConfig();
    refreshModelSelection();

    // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('modelMenu');
      const btn = document.getElementById('modelSelectBtn');
      
      if (!menu.contains(event.target) && !btn.contains(event.target)) {
        menu.classList.remove('active');
        btn.classList.remove('menu-active');
      }
    });

    /**
     * æ ¹æ®æŒ‡å®šçš„ schemeã€hostã€pathã€query å’Œ fragment ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ URL Scheme å­—ç¬¦ä¸²ã€‚
     * URL Scheme å®Œæ•´æ ¼å¼ï¼šscheme://host/path?query#fragment
     *
     * @param {string} scheme - URL schemeï¼Œä¾‹å¦‚ 'myapp'ã€‚å¿…é¡»æä¾›ã€‚
     * @param {string|undefined} [host] - host éƒ¨åˆ†ï¼Œä¾‹å¦‚ 'user_profile'ã€‚
     * @param {string|string[]|undefined} [path] - path éƒ¨åˆ†ï¼Œä¾‹å¦‚ 'view/123'ã€‚
     * @param {Object<string, string|number|boolean|object>|undefined} [query] - æŸ¥è¯¢å‚æ•°å¯¹è±¡ã€‚
     * @param {string|undefined} [fragment] - fragment æ ‡è¯†ç¬¦ï¼Œå³ URL ä¸­ # åé¢çš„éƒ¨åˆ†ã€‚
     * @returns {string} - ç”Ÿæˆçš„å®Œæ•´ URL å­—ç¬¦ä¸²ã€‚
     */
    function generateUrlScheme(scheme, host, path, query, fragment) {
      // 1. å¤„ç†å¿…é¡»çš„ scheme
      if (!scheme) {
        console.error("Scheme is a required parameter.");
        return '';
      }
      // 2. æ„å»ºåŸºç¡€éƒ¨åˆ†ï¼šscheme å’Œ host
      //    å³ä½¿ host ä¸ºç©ºï¼Œä¹Ÿä¼šç”Ÿæˆ 'scheme://'ï¼Œè¿™å¯¹äº 'file:///' è¿™ç±» scheme æ˜¯æ­£ç¡®çš„
      let url = `${scheme}://${host || ''}`;

      // 3. æ·»åŠ  path
      if (path) {
        if (Array.isArray(path)) {
          let pathStr = path.join('/')
          url += `/${pathStr.replace(/^\/+/, '')}`;
        } else {
          // ç¡®ä¿ host å’Œ path ä¹‹é—´åªæœ‰ä¸€ä¸ªæ–œæ ï¼Œå¹¶å¤„ç† path å¼€å¤´å¯èƒ½å­˜åœ¨çš„æ–œæ 
          url += `/${path.replace(/^\/+/, '')}`;
        }
      }

      // 4. æ·»åŠ  query å‚æ•°
      if (query && Object.keys(query).length > 0) {
        const queryParts = [];
        for (const key in query) {
          // ç¡®ä¿æˆ‘ä»¬åªå¤„ç†å¯¹è±¡è‡ªèº«çš„å±æ€§
          if (Object.prototype.hasOwnProperty.call(query, key)) {
            const value = query[key];
            const encodedKey = encodeURIComponent(key);
            // å¯¹å€¼è¿›è¡Œç¼–ç ï¼Œå¦‚æœæ˜¯å¯¹è±¡ï¼Œåˆ™å…ˆåºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²
            const encodedValue = encodeURIComponent(
              typeof value === "object" && value !== null ? JSON.stringify(value) : value
            );
            queryParts.push(`${encodedKey}=${encodedValue}`);
          }
        }
        if (queryParts.length > 0) {
          url += `?${queryParts.join('&')}`;
        }
      }

      // 5. æ·»åŠ  fragment
      if (fragment) {
        // Fragment éƒ¨åˆ†ä¸åº”è¯¥è¢«ç¼–ç 
        url += `#${fragment}`;
      }

      return url;
    }

    /**
     *
     * @param {string} scheme - URL scheme, ä¾‹å¦‚ 'myapp'ã€‚
     * @param {string} [host] - å¯é€‰çš„è·¯å¾„æˆ–æ“ä½œåã€‚
     * @param {Object<string, string|number|boolean>} [params] - æŸ¥è¯¢å‚æ•°å¯¹è±¡ã€‚
     */
    function postMessageToAddon(scheme, host, path, params, fragment) {
      let url = generateUrlScheme(scheme, host, path, params, fragment)
      window.location.href = url
    }
    function generateImage() {
      const btn = document.querySelector('.generate-btn');
      const input = document.getElementById('promptInput');
      const overlay = document.getElementById('loadingOverlay');

      // 1. æ˜¾ç¤º Loading é®ç½© (CSSåŠ¨ç”»ä¼šè‡ªåŠ¨è§¦å‘)
      overlay.classList.add('active');

      // æŒ‰é’®åŠ¨ç”»
      btn.style.width = '50px';
      btn.querySelector('.btn-text').style.opacity = '0';

      console.log("æ­£åœ¨ç”Ÿæˆ: " + input.value + "ï¼Œä½¿ç”¨æ¨¡å‹: " + currentModel);
      postMessageToAddon('snipaste', 'imageGenerator', undefined, { 
        prompt: input.value,
        model: currentModel 
      })

      // // æ¼”ç¤ºï¼š3ç§’åå…³é—­ Loading å¹¶æ¢å¤ (æˆ‘å¯ç”¨äº†è¿™æ®µä»£ç ä»¥ä¾¿ä½ èƒ½çœ‹åˆ°æ•ˆæœ)
      // setTimeout(() => {
      //   // 2. éšè— Loading é®ç½©
      //   overlay.classList.remove('active');

      //   // æ¢å¤æŒ‰é’®
      //   btn.removeAttribute('style');
      //   btn.querySelector('.btn-text').removeAttribute('style');

      // }, 3000);
    }
    function stopLoading() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.remove('active');
    }
  </script>

</body>

</html>